"use strict";var re=Object.create;var E=Object.defineProperty;var oe=Object.getOwnPropertyDescriptor;var ne=Object.getOwnPropertyNames;var ie=Object.getPrototypeOf,ae=Object.prototype.hasOwnProperty;var se=(l,m)=>()=>(m||l((m={exports:{}}).exports,m),m.exports),ce=(l,m)=>{for(var C in m)E(l,C,{get:m[C],enumerable:!0})},K=(l,m,C,u)=>{if(m&&typeof m=="object"||typeof m=="function")for(let e of ne(m))!ae.call(l,e)&&e!==C&&E(l,e,{get:()=>m[e],enumerable:!(u=oe(m,e))||u.enumerable});return l};var V=(l,m,C)=>(C=l!=null?re(ie(l)):{},K(m||!l||!l.__esModule?E(C,"default",{value:l,enumerable:!0}):C,l)),le=l=>K(E({},"__esModule",{value:!0}),l);var M=se((Ce,k)=>{(function(){"use strict";var l=typeof window=="object"?window:{},m=!l.HI_BASE32_NO_NODE_JS&&typeof process=="object"&&process.versions&&process.versions.node;m&&(l=global);var C=!l.HI_BASE32_NO_COMMON_JS&&typeof k=="object"&&k.exports,u=typeof define=="function"&&define.amd,e="ABCDEFGHIJKLMNOPQRSTUVWXYZ234567".split(""),i={A:0,B:1,C:2,D:3,E:4,F:5,G:6,H:7,I:8,J:9,K:10,L:11,M:12,N:13,O:14,P:15,Q:16,R:17,S:18,T:19,U:20,V:21,W:22,X:23,Y:24,Z:25,2:26,3:27,4:28,5:29,6:30,7:31},h=[0,0,0,0,0,0,0,0],F=function(t,n){n.length>10&&(n="..."+n.substr(-10));var o=new Error("Decoded data is not valid UTF-8. Maybe try base32.decode.asBytes()? Partial data after reading "+t+" bytes: "+n+" <-");throw o.position=t,o},w=function(t){for(var n="",o=t.length,a=0,p=0,A,s;a<o;){if(A=t[a++],A<=127){n+=String.fromCharCode(A);continue}else A>191&&A<=223?(s=A&31,p=1):A<=239?(s=A&15,p=2):A<=247?(s=A&7,p=3):F(a,n);for(var y=0;y<p;++y)A=t[a++],(A<128||A>191)&&F(a,n),s<<=6,s+=A&63;s>=55296&&s<=57343&&F(a,n),s>1114111&&F(a,n),s<=65535?n+=String.fromCharCode(s):(s-=65536,n+=String.fromCharCode((s>>10)+55296),n+=String.fromCharCode((s&1023)+56320))}return n},S=function(t){if(t==="")return[];if(!/^[A-Z2-7=]+$/.test(t))throw new Error("Invalid base32 characters");t=t.replace(/=/g,"");for(var n,o,a,p,A,s,y,g,v=[],f=0,P=t.length,c=0,O=P>>3<<3;c<O;)n=i[t.charAt(c++)],o=i[t.charAt(c++)],a=i[t.charAt(c++)],p=i[t.charAt(c++)],A=i[t.charAt(c++)],s=i[t.charAt(c++)],y=i[t.charAt(c++)],g=i[t.charAt(c++)],v[f++]=(n<<3|o>>>2)&255,v[f++]=(o<<6|a<<1|p>>>4)&255,v[f++]=(p<<4|A>>>1)&255,v[f++]=(A<<7|s<<2|y>>>3)&255,v[f++]=(y<<5|g)&255;var D=P-O;return D===2?(n=i[t.charAt(c++)],o=i[t.charAt(c++)],v[f++]=(n<<3|o>>>2)&255):D===4?(n=i[t.charAt(c++)],o=i[t.charAt(c++)],a=i[t.charAt(c++)],p=i[t.charAt(c++)],v[f++]=(n<<3|o>>>2)&255,v[f++]=(o<<6|a<<1|p>>>4)&255):D===5?(n=i[t.charAt(c++)],o=i[t.charAt(c++)],a=i[t.charAt(c++)],p=i[t.charAt(c++)],A=i[t.charAt(c++)],v[f++]=(n<<3|o>>>2)&255,v[f++]=(o<<6|a<<1|p>>>4)&255,v[f++]=(p<<4|A>>>1)&255):D===7&&(n=i[t.charAt(c++)],o=i[t.charAt(c++)],a=i[t.charAt(c++)],p=i[t.charAt(c++)],A=i[t.charAt(c++)],s=i[t.charAt(c++)],y=i[t.charAt(c++)],v[f++]=(n<<3|o>>>2)&255,v[f++]=(o<<6|a<<1|p>>>4)&255,v[f++]=(p<<4|A>>>1)&255,v[f++]=(A<<7|s<<2|y>>>3)&255),v},L=function(t){for(var n,o,a,p,A,s="",y=t.length,g=0,v=parseInt(y/5)*5;g<v;)n=t.charCodeAt(g++),o=t.charCodeAt(g++),a=t.charCodeAt(g++),p=t.charCodeAt(g++),A=t.charCodeAt(g++),s+=e[n>>>3]+e[(n<<2|o>>>6)&31]+e[o>>>1&31]+e[(o<<4|a>>>4)&31]+e[(a<<1|p>>>7)&31]+e[p>>>2&31]+e[(p<<3|A>>>5)&31]+e[A&31];var f=y-v;return f===1?(n=t.charCodeAt(g),s+=e[n>>>3]+e[n<<2&31]+"======"):f===2?(n=t.charCodeAt(g++),o=t.charCodeAt(g),s+=e[n>>>3]+e[(n<<2|o>>>6)&31]+e[o>>>1&31]+e[o<<4&31]+"===="):f===3?(n=t.charCodeAt(g++),o=t.charCodeAt(g++),a=t.charCodeAt(g),s+=e[n>>>3]+e[(n<<2|o>>>6)&31]+e[o>>>1&31]+e[(o<<4|a>>>4)&31]+e[a<<1&31]+"==="):f===4&&(n=t.charCodeAt(g++),o=t.charCodeAt(g++),a=t.charCodeAt(g++),p=t.charCodeAt(g),s+=e[n>>>3]+e[(n<<2|o>>>6)&31]+e[o>>>1&31]+e[(o<<4|a>>>4)&31]+e[(a<<1|p>>>7)&31]+e[p>>>2&31]+e[p<<3&31]+"="),s},b=function(t){var n,o,a,p,A,s,y=!1,g="",v=0,f,P=0,c=0,O=t.length;if(t==="")return g;do{for(h[0]=h[5],h[1]=h[6],h[2]=h[7],f=P;v<O&&f<5;++v)s=t.charCodeAt(v),s<128?h[f++]=s:s<2048?(h[f++]=192|s>>6,h[f++]=128|s&63):s<55296||s>=57344?(h[f++]=224|s>>12,h[f++]=128|s>>6&63,h[f++]=128|s&63):(s=65536+((s&1023)<<10|t.charCodeAt(++v)&1023),h[f++]=240|s>>18,h[f++]=128|s>>12&63,h[f++]=128|s>>6&63,h[f++]=128|s&63);c+=f-P,P=f-5,v===O&&++v,v>O&&f<6&&(y=!0),n=h[0],f>4?(o=h[1],a=h[2],p=h[3],A=h[4],g+=e[n>>>3]+e[(n<<2|o>>>6)&31]+e[o>>>1&31]+e[(o<<4|a>>>4)&31]+e[(a<<1|p>>>7)&31]+e[p>>>2&31]+e[(p<<3|A>>>5)&31]+e[A&31]):f===1?g+=e[n>>>3]+e[n<<2&31]+"======":f===2?(o=h[1],g+=e[n>>>3]+e[(n<<2|o>>>6)&31]+e[o>>>1&31]+e[o<<4&31]+"===="):f===3?(o=h[1],a=h[2],g+=e[n>>>3]+e[(n<<2|o>>>6)&31]+e[o>>>1&31]+e[(o<<4|a>>>4)&31]+e[a<<1&31]+"==="):(o=h[1],a=h[2],p=h[3],g+=e[n>>>3]+e[(n<<2|o>>>6)&31]+e[o>>>1&31]+e[(o<<4|a>>>4)&31]+e[(a<<1|p>>>7)&31]+e[p>>>2&31]+e[p<<3&31]+"=")}while(!y);return g},ee=function(t){for(var n,o,a,p,A,s="",y=t.length,g=0,v=parseInt(y/5)*5;g<v;)n=t[g++],o=t[g++],a=t[g++],p=t[g++],A=t[g++],s+=e[n>>>3]+e[(n<<2|o>>>6)&31]+e[o>>>1&31]+e[(o<<4|a>>>4)&31]+e[(a<<1|p>>>7)&31]+e[p>>>2&31]+e[(p<<3|A>>>5)&31]+e[A&31];var f=y-v;return f===1?(n=t[g],s+=e[n>>>3]+e[n<<2&31]+"======"):f===2?(n=t[g++],o=t[g],s+=e[n>>>3]+e[(n<<2|o>>>6)&31]+e[o>>>1&31]+e[o<<4&31]+"===="):f===3?(n=t[g++],o=t[g++],a=t[g],s+=e[n>>>3]+e[(n<<2|o>>>6)&31]+e[o>>>1&31]+e[(o<<4|a>>>4)&31]+e[a<<1&31]+"==="):f===4&&(n=t[g++],o=t[g++],a=t[g++],p=t[g],s+=e[n>>>3]+e[(n<<2|o>>>6)&31]+e[o>>>1&31]+e[(o<<4|a>>>4)&31]+e[(a<<1|p>>>7)&31]+e[p>>>2&31]+e[p<<3&31]+"="),s},te=function(t,n){var o=typeof t!="string";return o&&t.constructor===ArrayBuffer&&(t=new Uint8Array(t)),o?ee(t):n?L(t):b(t)},$=function(t,n){if(!n)return w(S(t));if(t==="")return"";if(!/^[A-Z2-7=]+$/.test(t))throw new Error("Invalid base32 characters");var o,a,p,A,s,y,g,v,f="",P=t.indexOf("=");P===-1&&(P=t.length);for(var c=0,O=P>>3<<3;c<O;)o=i[t.charAt(c++)],a=i[t.charAt(c++)],p=i[t.charAt(c++)],A=i[t.charAt(c++)],s=i[t.charAt(c++)],y=i[t.charAt(c++)],g=i[t.charAt(c++)],v=i[t.charAt(c++)],f+=String.fromCharCode((o<<3|a>>>2)&255)+String.fromCharCode((a<<6|p<<1|A>>>4)&255)+String.fromCharCode((A<<4|s>>>1)&255)+String.fromCharCode((s<<7|y<<2|g>>>3)&255)+String.fromCharCode((g<<5|v)&255);var D=P-O;return D===2?(o=i[t.charAt(c++)],a=i[t.charAt(c++)],f+=String.fromCharCode((o<<3|a>>>2)&255)):D===4?(o=i[t.charAt(c++)],a=i[t.charAt(c++)],p=i[t.charAt(c++)],A=i[t.charAt(c++)],f+=String.fromCharCode((o<<3|a>>>2)&255)+String.fromCharCode((a<<6|p<<1|A>>>4)&255)):D===5?(o=i[t.charAt(c++)],a=i[t.charAt(c++)],p=i[t.charAt(c++)],A=i[t.charAt(c++)],s=i[t.charAt(c++)],f+=String.fromCharCode((o<<3|a>>>2)&255)+String.fromCharCode((a<<6|p<<1|A>>>4)&255)+String.fromCharCode((A<<4|s>>>1)&255)):D===7&&(o=i[t.charAt(c++)],a=i[t.charAt(c++)],p=i[t.charAt(c++)],A=i[t.charAt(c++)],s=i[t.charAt(c++)],y=i[t.charAt(c++)],g=i[t.charAt(c++)],f+=String.fromCharCode((o<<3|a>>>2)&255)+String.fromCharCode((a<<6|p<<1|A>>>4)&255)+String.fromCharCode((A<<4|s>>>1)&255)+String.fromCharCode((s<<7|y<<2|g>>>3)&255)),f},_={encode:te,decode:$};$.asBytes=S,C?k.exports=_:(l.base32=_,u&&define(function(){return _}))})()});var Ae={};ce(Ae,{default:()=>z});module.exports=le(Ae);var x=require("@raycast/api"),H=V(require("fs"));var G=require("crypto"),J=V(M()),de=[6,7,8],pe=["SHA1","SHA256","SHA512"],N={digits:6,algorithm:"SHA1",period:30};function fe(l){return!!pe.find(m=>m===l)}function me(l){return!!de.find(m=>m==l)}function ue(l,m,C){let u=(0,G.createHmac)(C,l),e=Buffer.alloc(8);return e.writeBigInt64BE(m),u.update(e),u.digest()}function he(l,m){let C=l[l.length-1]&15;return(l.slice(C,C+4).readUInt32BE()&2147483647)%Math.pow(10,m)}function Y(l,m){let C=Math.floor(new Date().getTime()/1e3/m.period),u=J.decode.asBytes(l.toUpperCase());return he(ue(Buffer.from(u),BigInt(C),m.algorithm),m.digits)}function U(l){try{return JSON.parse(l)}catch{return{secret:l,options:N,lastTimeUsed:new Date().getTime()}}}function R(l){try{let m=new URL(l);if(m.protocol!=="otpauth:")return{success:!1,data:"Unsupported protocol "+m.protocol};if(m.host!=="totp")return{success:!1,data:"Unsupported type "+m.host+" only TOTP supported"};if(!m.pathname)return{success:!1,data:"Label is missing"};let C=decodeURIComponent(m.pathname.slice(1)),u=m.searchParams,e=u.get("secret"),i=u.get("algorithm")?u.get("algorithm"):N.algorithm,h=u.get("period"),F=h?parseInt(h):N.period,w=u.get("digits")?u.get("digits"):N.digits;if(!e)return{success:!1,data:"Secret is mandatory"};try{J.decode.asBytes(e)}catch{return{success:!1,data:"Invalid 2FA secret"}}return fe(i)?isNaN(F)||F<=0?{success:!1,data:"Period should be a positive number"}:me(w)?{success:!0,data:{name:C,data:{secret:e,options:{digits:w,period:F,algorithm:i}}}}:{success:!1,data:"Unsupported digits "+w}:{success:!1,data:"Unsupported hashing algorithm "+i}}catch{return{success:!1,data:"Unable to parse URL"}}}var q=require("@raycast/api");var r=require("@raycast/api"),j=V(M());var Z=require("@raycast/api"),T=require("react");function W(l){let[m,C]=(0,T.useState)([]);async function u(){let e=await Z.LocalStorage.allItems();C(Object.keys(e).sort((i,h)=>{let F=U(e[i]).lastTimeUsed??1,S=(U(e[h]).lastTimeUsed??1)-F;return S===0?i.localeCompare(h):S}).map(i=>{let h=U(e[i]);return{name:i,key:e[i].toString(),time:`${Math.floor(h.options.period-new Date().getTime()/1e3%h.options.period)}`,percent:Math.floor(h.options.period-new Date().getTime()/1e3%h.options.period)/h.options.period*100,code:Y(h.secret,h.options).toString().padStart(h.options.digits,"0"),secret:h.secret,options:h.options}}))}return(0,T.useEffect)(()=>{u()},[]),(0,T.useEffect)(()=>{if(l?.doUpdates!==!1){u();let e=setInterval(u,100);return()=>clearInterval(e)}},[l?.doUpdates]),{apps:m,updateApps:u}}var d=require("react/jsx-runtime");function B(){let{apps:l,updateApps:m}=W(),{defaultAction:C}=(0,r.getPreferenceValues)(),u=async e=>{let i=await r.LocalStorage.getItem(e.name),h={...U(i),lastTimeUsed:new Date().getTime()};await r.LocalStorage.setItem(e.name,JSON.stringify(h))};return(0,d.jsx)(r.List,{actions:(0,d.jsxs)(r.ActionPanel,{children:[(0,d.jsx)(r.Action.Push,{icon:r.Icon.Plus,title:"Add App",target:(0,d.jsx)(X,{}),shortcut:{modifiers:["cmd"],key:"g"}}),(0,d.jsx)(r.Action.Push,{icon:r.Icon.Link,title:"Add App by URL",target:(0,d.jsx)(Q,{}),shortcut:{modifiers:["cmd"],key:"u"}})]}),children:l.map(e=>(0,d.jsx)(r.List.Item,{title:e.name,subtitle:e.code,accessories:[{icon:{source:+e.percent>75?r.Icon.CircleProgress100:+e.percent>50?r.Icon.CircleProgress75:+e.percent>25?r.Icon.CircleProgress50:+e.time>0?r.Icon.CircleProgress25:r.Icon.Circle},tooltip:e.time}],actions:(0,d.jsxs)(r.ActionPanel,{children:[(0,d.jsx)(r.ActionPanel.Section,{children:C=="copy"?(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(r.Action.CopyToClipboard,{content:e.code,title:"Copy Code",onCopy:()=>u(e)}),(0,d.jsx)(r.Action.Paste,{content:e.code,title:"Paste Code",onPaste:()=>u(e)})]}):(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(r.Action.Paste,{content:e.code,title:"Paste Code",onPaste:()=>u(e)}),(0,d.jsx)(r.Action.CopyToClipboard,{content:e.code,title:"Copy Code",onCopy:()=>u(e)})]})}),(0,d.jsxs)(r.ActionPanel.Section,{children:[(0,d.jsx)(r.Action.Push,{icon:r.Icon.Plus,title:"Add App",target:(0,d.jsx)(X,{}),shortcut:{modifiers:["cmd"],key:"g"}}),(0,d.jsx)(r.Action.Push,{icon:r.Icon.Link,title:"Add App by URL",target:(0,d.jsx)(Q,{}),shortcut:{modifiers:["cmd"],key:"u"}})]}),(0,d.jsxs)(r.ActionPanel.Section,{children:[(0,d.jsx)(r.Action,{icon:r.Icon.Trash,title:"Remove App",onAction:async()=>{await(0,r.confirmAlert)({title:"Remove App?",message:"Your key will be lost forever, unless you've performed a backup.",primaryAction:{title:"Remove",style:r.Alert.ActionStyle.Destructive}})&&(await r.LocalStorage.removeItem(e.name),await m())},shortcut:{modifiers:["ctrl"],key:"return"}}),(0,d.jsx)(r.Action.Push,{icon:r.Icon.Pencil,title:"Edit App",target:(0,d.jsx)(ge,{app:e}),shortcut:r.Keyboard.Shortcut.Common.Edit})]})]})},e.name))})}function X(){let{push:l}=(0,r.useNavigation)(),m=async C=>{let u=C;if(!u.name||!u.secret){(0,r.showToast)(r.Toast.Style.Failure,"Please provide both fields");return}if(u.secret=u.secret.replace(/[-\s]/g,"").toUpperCase(),await r.LocalStorage.getItem(u.name)){(0,r.showToast)(r.Toast.Style.Failure,"This app name is already taken");return}try{j.decode.asBytes(u.secret)}catch{(0,r.showToast)(r.Toast.Style.Failure,"Invalid 2FA secret");return}if(isNaN(u.period)){(0,r.showToast)(r.Toast.Style.Failure,"Period should be a number");return}if(+u.period<=0){(0,r.showToast)(r.Toast.Style.Failure,"Period should be positive number");return}let e={digits:u.digits,period:u.period,algorithm:u.algorithm};await r.LocalStorage.setItem(u.name,JSON.stringify({secret:u.secret,options:e,lastTimeUsed:new Date().getTime()})),l((0,d.jsx)(B,{}))};return(0,d.jsxs)(r.Form,{actions:(0,d.jsx)(r.ActionPanel,{children:(0,d.jsx)(r.Action.SubmitForm,{icon:r.Icon.Plus,title:"Submit",onSubmit:m})}),children:[(0,d.jsx)(r.Form.TextField,{id:"name",title:"App Name",placeholder:"e.g. GitHub"}),(0,d.jsx)(r.Form.TextField,{id:"secret",title:"2FA Secret",placeholder:"Get this from your provider"}),(0,d.jsx)(r.Form.TextField,{id:"period",title:"Period",placeholder:"A period that a TOTP code will be valid for",defaultValue:"30"}),(0,d.jsxs)(r.Form.Dropdown,{id:"digits",title:"Digits count",defaultValue:"6",children:[(0,d.jsx)(r.Form.Dropdown.Item,{title:"6",value:"6"}),(0,d.jsx)(r.Form.Dropdown.Item,{title:"7",value:"7"}),(0,d.jsx)(r.Form.Dropdown.Item,{title:"8",value:"8"})]}),(0,d.jsxs)(r.Form.Dropdown,{id:"algorithm",title:"Algorithm",defaultValue:"SHA1",children:[(0,d.jsx)(r.Form.Dropdown.Item,{title:"SHA1",value:"SHA1"}),(0,d.jsx)(r.Form.Dropdown.Item,{title:"SHA256",value:"SHA256"}),(0,d.jsx)(r.Form.Dropdown.Item,{title:"SHA512",value:"SHA512"})]})]})}function Q(){let{push:l}=(0,r.useNavigation)(),m=async C=>{let{url:u}=C;if(!u){(0,r.showToast)(r.Toast.Style.Failure,"Please provide both fields");return}let e=R(u);if(!e.success){(0,r.showToast)(r.Toast.Style.Failure,e.data);return}await r.LocalStorage.setItem(e.data.name,JSON.stringify(e.data.data)),l((0,d.jsx)(B,{}))};return(0,d.jsx)(r.Form,{actions:(0,d.jsx)(r.ActionPanel,{children:(0,d.jsx)(r.Action.SubmitForm,{icon:r.Icon.Plus,title:"Submit",onSubmit:m})}),children:(0,d.jsx)(r.Form.TextArea,{id:"url",title:"Otpauth URL",placeholder:"e.g. otpauth://totp/Example:alice@google.com?secret=JBSWY3DPEHPK3PXP&issuer=Example"})})}function ge({app:l}){let{pop:m}=(0,r.useNavigation)(),C=async u=>{let{name:e}=u;if(!e){(0,r.showToast)(r.Toast.Style.Failure,"Please provide name");return}if(await r.LocalStorage.getItem(e)){(0,r.showToast)(r.Toast.Style.Failure,"This app name is already taken");return}let i=await r.LocalStorage.getItem(l.name);await r.LocalStorage.removeItem(l.name),await r.LocalStorage.setItem(e,i),m()};return(0,d.jsxs)(r.Form,{actions:(0,d.jsx)(r.ActionPanel,{children:(0,d.jsx)(r.Action.SubmitForm,{icon:r.Icon.Pencil,title:"Submit",onSubmit:C})}),children:[(0,d.jsx)(r.Form.TextField,{id:"name",title:"App Name",placeholder:l.name,defaultValue:l.name}),(0,d.jsx)(r.Form.Description,{title:"\u26A0\uFE0F",text:"To prevent loss of data, please Backup your codes first"})]})}var I=require("react/jsx-runtime");function z(){let{push:l}=(0,x.useNavigation)(),m=async C=>{let u=C.files[0];if(!H.default.existsSync(u)||!H.default.lstatSync(u).isFile()){(0,x.showToast)(x.Toast.Style.Failure,"Invalid backup file");return}try{let i=H.default.readFileSync(u,"utf-8").split(`
`).filter(F=>F.trim()!==""),h=0;for(let F of i){let w=R(F);if(w.success){let{name:S,data:L}=w.data;await q.LocalStorage.setItem(S,JSON.stringify(L)),h++}}(0,x.showToast)(x.Toast.Style.Success,`Restored ${h} app${h>1?"s":""}`),l((0,I.jsx)(B,{}))}catch{(0,x.showToast)(x.Toast.Style.Failure,"Failed to restore backup")}};return(0,I.jsx)(x.Form,{actions:(0,I.jsx)(x.ActionPanel,{children:(0,I.jsx)(x.Action.SubmitForm,{title:"Restore",onSubmit:m})}),children:(0,I.jsx)(x.Form.FilePicker,{id:"files",title:"Select backup file",allowMultipleSelection:!1,canChooseDirectories:!1,canChooseFiles:!0})})}
/*! Bundled license information:

hi-base32/src/base32.js:
  (*
   * [hi-base32]{@link https://github.com/emn178/hi-base32}
   *
   * @version 0.5.0
   * @author Chen, Yi-Cyuan [emn178@gmail.com]
   * @copyright Chen, Yi-Cyuan 2015-2018
   * @license MIT
   *)
*/
