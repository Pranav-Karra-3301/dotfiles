"use strict";var Q=Object.create;var D=Object.defineProperty;var W=Object.getOwnPropertyDescriptor;var X=Object.getOwnPropertyNames;var q=Object.getPrototypeOf,z=Object.prototype.hasOwnProperty;var b=(h,u)=>()=>(u||h((u={exports:{}}).exports,u),u.exports),ee=(h,u)=>{for(var A in u)D(h,A,{get:u[A],enumerable:!0})},N=(h,u,A,m)=>{if(u&&typeof u=="object"||typeof u=="function")for(let t of X(u))!z.call(h,t)&&t!==A&&D(h,t,{get:()=>u[t],enumerable:!(m=W(u,t))||m.enumerable});return h};var M=(h,u,A)=>(A=h!=null?Q(q(h)):{},N(u||!h||!h.__esModule?D(A,"default",{value:h,enumerable:!0}):A,h)),te=h=>N(D({},"__esModule",{value:!0}),h);var H=b((ce,I)=>{(function(){"use strict";var h=typeof window=="object"?window:{},u=!h.HI_BASE32_NO_NODE_JS&&typeof process=="object"&&process.versions&&process.versions.node;u&&(h=global);var A=!h.HI_BASE32_NO_COMMON_JS&&typeof I=="object"&&I.exports,m=typeof define=="function"&&define.amd,t="ABCDEFGHIJKLMNOPQRSTUVWXYZ234567".split(""),n={A:0,B:1,C:2,D:3,E:4,F:5,G:6,H:7,I:8,J:9,K:10,L:11,M:12,N:13,O:14,P:15,Q:16,R:17,S:18,T:19,U:20,V:21,W:22,X:23,Y:24,Z:25,2:26,3:27,4:28,5:29,6:30,7:31},p=[0,0,0,0,0,0,0,0],U=function(e,o){o.length>10&&(o="..."+o.substr(-10));var r=new Error("Decoded data is not valid UTF-8. Maybe try base32.decode.asBytes()? Partial data after reading "+e+" bytes: "+o+" <-");throw r.position=e,r},k=function(e){for(var o="",r=e.length,a=0,i=0,l,s;a<r;){if(l=e[a++],l<=127){o+=String.fromCharCode(l);continue}else l>191&&l<=223?(s=l&31,i=1):l<=239?(s=l&15,i=2):l<=247?(s=l&7,i=3):U(a,o);for(var v=0;v<i;++v)l=e[a++],(l<128||l>191)&&U(a,o),s<<=6,s+=l&63;s>=55296&&s<=57343&&U(a,o),s>1114111&&U(a,o),s<=65535?o+=String.fromCharCode(s):(s-=65536,o+=String.fromCharCode((s>>10)+55296),o+=String.fromCharCode((s&1023)+56320))}return o},y=function(e){if(e==="")return[];if(!/^[A-Z2-7=]+$/.test(e))throw new Error("Invalid base32 characters");e=e.replace(/=/g,"");for(var o,r,a,i,l,s,v,d,g=[],f=0,x=e.length,c=0,O=x>>3<<3;c<O;)o=n[e.charAt(c++)],r=n[e.charAt(c++)],a=n[e.charAt(c++)],i=n[e.charAt(c++)],l=n[e.charAt(c++)],s=n[e.charAt(c++)],v=n[e.charAt(c++)],d=n[e.charAt(c++)],g[f++]=(o<<3|r>>>2)&255,g[f++]=(r<<6|a<<1|i>>>4)&255,g[f++]=(i<<4|l>>>1)&255,g[f++]=(l<<7|s<<2|v>>>3)&255,g[f++]=(v<<5|d)&255;var F=x-O;return F===2?(o=n[e.charAt(c++)],r=n[e.charAt(c++)],g[f++]=(o<<3|r>>>2)&255):F===4?(o=n[e.charAt(c++)],r=n[e.charAt(c++)],a=n[e.charAt(c++)],i=n[e.charAt(c++)],g[f++]=(o<<3|r>>>2)&255,g[f++]=(r<<6|a<<1|i>>>4)&255):F===5?(o=n[e.charAt(c++)],r=n[e.charAt(c++)],a=n[e.charAt(c++)],i=n[e.charAt(c++)],l=n[e.charAt(c++)],g[f++]=(o<<3|r>>>2)&255,g[f++]=(r<<6|a<<1|i>>>4)&255,g[f++]=(i<<4|l>>>1)&255):F===7&&(o=n[e.charAt(c++)],r=n[e.charAt(c++)],a=n[e.charAt(c++)],i=n[e.charAt(c++)],l=n[e.charAt(c++)],s=n[e.charAt(c++)],v=n[e.charAt(c++)],g[f++]=(o<<3|r>>>2)&255,g[f++]=(r<<6|a<<1|i>>>4)&255,g[f++]=(i<<4|l>>>1)&255,g[f++]=(l<<7|s<<2|v>>>3)&255),g},K=function(e){for(var o,r,a,i,l,s="",v=e.length,d=0,g=parseInt(v/5)*5;d<g;)o=e.charCodeAt(d++),r=e.charCodeAt(d++),a=e.charCodeAt(d++),i=e.charCodeAt(d++),l=e.charCodeAt(d++),s+=t[o>>>3]+t[(o<<2|r>>>6)&31]+t[r>>>1&31]+t[(r<<4|a>>>4)&31]+t[(a<<1|i>>>7)&31]+t[i>>>2&31]+t[(i<<3|l>>>5)&31]+t[l&31];var f=v-g;return f===1?(o=e.charCodeAt(d),s+=t[o>>>3]+t[o<<2&31]+"======"):f===2?(o=e.charCodeAt(d++),r=e.charCodeAt(d),s+=t[o>>>3]+t[(o<<2|r>>>6)&31]+t[r>>>1&31]+t[r<<4&31]+"===="):f===3?(o=e.charCodeAt(d++),r=e.charCodeAt(d++),a=e.charCodeAt(d),s+=t[o>>>3]+t[(o<<2|r>>>6)&31]+t[r>>>1&31]+t[(r<<4|a>>>4)&31]+t[a<<1&31]+"==="):f===4&&(o=e.charCodeAt(d++),r=e.charCodeAt(d++),a=e.charCodeAt(d++),i=e.charCodeAt(d),s+=t[o>>>3]+t[(o<<2|r>>>6)&31]+t[r>>>1&31]+t[(r<<4|a>>>4)&31]+t[(a<<1|i>>>7)&31]+t[i>>>2&31]+t[i<<3&31]+"="),s},Y=function(e){var o,r,a,i,l,s,v=!1,d="",g=0,f,x=0,c=0,O=e.length;if(e==="")return d;do{for(p[0]=p[5],p[1]=p[6],p[2]=p[7],f=x;g<O&&f<5;++g)s=e.charCodeAt(g),s<128?p[f++]=s:s<2048?(p[f++]=192|s>>6,p[f++]=128|s&63):s<55296||s>=57344?(p[f++]=224|s>>12,p[f++]=128|s>>6&63,p[f++]=128|s&63):(s=65536+((s&1023)<<10|e.charCodeAt(++g)&1023),p[f++]=240|s>>18,p[f++]=128|s>>12&63,p[f++]=128|s>>6&63,p[f++]=128|s&63);c+=f-x,x=f-5,g===O&&++g,g>O&&f<6&&(v=!0),o=p[0],f>4?(r=p[1],a=p[2],i=p[3],l=p[4],d+=t[o>>>3]+t[(o<<2|r>>>6)&31]+t[r>>>1&31]+t[(r<<4|a>>>4)&31]+t[(a<<1|i>>>7)&31]+t[i>>>2&31]+t[(i<<3|l>>>5)&31]+t[l&31]):f===1?d+=t[o>>>3]+t[o<<2&31]+"======":f===2?(r=p[1],d+=t[o>>>3]+t[(o<<2|r>>>6)&31]+t[r>>>1&31]+t[r<<4&31]+"===="):f===3?(r=p[1],a=p[2],d+=t[o>>>3]+t[(o<<2|r>>>6)&31]+t[r>>>1&31]+t[(r<<4|a>>>4)&31]+t[a<<1&31]+"==="):(r=p[1],a=p[2],i=p[3],d+=t[o>>>3]+t[(o<<2|r>>>6)&31]+t[r>>>1&31]+t[(r<<4|a>>>4)&31]+t[(a<<1|i>>>7)&31]+t[i>>>2&31]+t[i<<3&31]+"=")}while(!v);return d},j=function(e){for(var o,r,a,i,l,s="",v=e.length,d=0,g=parseInt(v/5)*5;d<g;)o=e[d++],r=e[d++],a=e[d++],i=e[d++],l=e[d++],s+=t[o>>>3]+t[(o<<2|r>>>6)&31]+t[r>>>1&31]+t[(r<<4|a>>>4)&31]+t[(a<<1|i>>>7)&31]+t[i>>>2&31]+t[(i<<3|l>>>5)&31]+t[l&31];var f=v-g;return f===1?(o=e[d],s+=t[o>>>3]+t[o<<2&31]+"======"):f===2?(o=e[d++],r=e[d],s+=t[o>>>3]+t[(o<<2|r>>>6)&31]+t[r>>>1&31]+t[r<<4&31]+"===="):f===3?(o=e[d++],r=e[d++],a=e[d],s+=t[o>>>3]+t[(o<<2|r>>>6)&31]+t[r>>>1&31]+t[(r<<4|a>>>4)&31]+t[a<<1&31]+"==="):f===4&&(o=e[d++],r=e[d++],a=e[d++],i=e[d],s+=t[o>>>3]+t[(o<<2|r>>>6)&31]+t[r>>>1&31]+t[(r<<4|a>>>4)&31]+t[(a<<1|i>>>7)&31]+t[i>>>2&31]+t[i<<3&31]+"="),s},G=function(e,o){var r=typeof e!="string";return r&&e.constructor===ArrayBuffer&&(e=new Uint8Array(e)),r?j(e):o?K(e):Y(e)},_=function(e,o){if(!o)return k(y(e));if(e==="")return"";if(!/^[A-Z2-7=]+$/.test(e))throw new Error("Invalid base32 characters");var r,a,i,l,s,v,d,g,f="",x=e.indexOf("=");x===-1&&(x=e.length);for(var c=0,O=x>>3<<3;c<O;)r=n[e.charAt(c++)],a=n[e.charAt(c++)],i=n[e.charAt(c++)],l=n[e.charAt(c++)],s=n[e.charAt(c++)],v=n[e.charAt(c++)],d=n[e.charAt(c++)],g=n[e.charAt(c++)],f+=String.fromCharCode((r<<3|a>>>2)&255)+String.fromCharCode((a<<6|i<<1|l>>>4)&255)+String.fromCharCode((l<<4|s>>>1)&255)+String.fromCharCode((s<<7|v<<2|d>>>3)&255)+String.fromCharCode((d<<5|g)&255);var F=x-O;return F===2?(r=n[e.charAt(c++)],a=n[e.charAt(c++)],f+=String.fromCharCode((r<<3|a>>>2)&255)):F===4?(r=n[e.charAt(c++)],a=n[e.charAt(c++)],i=n[e.charAt(c++)],l=n[e.charAt(c++)],f+=String.fromCharCode((r<<3|a>>>2)&255)+String.fromCharCode((a<<6|i<<1|l>>>4)&255)):F===5?(r=n[e.charAt(c++)],a=n[e.charAt(c++)],i=n[e.charAt(c++)],l=n[e.charAt(c++)],s=n[e.charAt(c++)],f+=String.fromCharCode((r<<3|a>>>2)&255)+String.fromCharCode((a<<6|i<<1|l>>>4)&255)+String.fromCharCode((l<<4|s>>>1)&255)):F===7&&(r=n[e.charAt(c++)],a=n[e.charAt(c++)],i=n[e.charAt(c++)],l=n[e.charAt(c++)],s=n[e.charAt(c++)],v=n[e.charAt(c++)],d=n[e.charAt(c++)],f+=String.fromCharCode((r<<3|a>>>2)&255)+String.fromCharCode((a<<6|i<<1|l>>>4)&255)+String.fromCharCode((l<<4|s>>>1)&255)+String.fromCharCode((s<<7|v<<2|d>>>3)&255)),f},E={encode:G,decode:_};_.asBytes=y,A?I.exports=E:(h.base32=E,m&&define(function(){return E}))})()});var ae={};ee(ae,{default:()=>Z});module.exports=te(ae);var C=require("@raycast/api");var R=require("crypto"),L=M(H());var re={digits:6,algorithm:"SHA1",period:30};function oe(h,u,A){let m=(0,R.createHmac)(A,h),t=Buffer.alloc(8);return t.writeBigInt64BE(u),m.update(t),m.digest()}function ne(h,u){let A=h[h.length-1]&15;return(h.slice(A,A+4).readUInt32BE()&2147483647)%Math.pow(10,u)}function J(h,u){let A=Math.floor(new Date().getTime()/1e3/u.period),m=L.decode.asBytes(h.toUpperCase());return ne(oe(Buffer.from(m),BigInt(A),u.algorithm),u.digits)}function T(h){try{return JSON.parse(h)}catch{return{secret:h,options:re,lastTimeUsed:new Date().getTime()}}}function $(h,u,A){let m=new URL(`otpauth://totp/${encodeURIComponent(h)}`);return m.searchParams.set("secret",u),m.searchParams.set("algorithm",A.algorithm),m.searchParams.set("period",A.period.toString()),m.searchParams.set("digits",A.digits.toString()),m.toString()}var P=M(require("fs"));var S=require("@raycast/api"),w=require("react");function V(h){let[u,A]=(0,w.useState)([]);async function m(){let t=await S.LocalStorage.allItems();A(Object.keys(t).sort((n,p)=>{let U=T(t[n]).lastTimeUsed??1,y=(T(t[p]).lastTimeUsed??1)-U;return y===0?n.localeCompare(p):y}).map(n=>{let p=T(t[n]);return{name:n,key:t[n].toString(),time:`${Math.floor(p.options.period-new Date().getTime()/1e3%p.options.period)}`,percent:Math.floor(p.options.period-new Date().getTime()/1e3%p.options.period)/p.options.period*100,code:J(p.secret,p.options).toString().padStart(p.options.digits,"0"),secret:p.secret,options:p.options}}))}return(0,w.useEffect)(()=>{m()},[]),(0,w.useEffect)(()=>{if(h?.doUpdates!==!1){m();let t=setInterval(m,100);return()=>clearInterval(t)}},[h?.doUpdates]),{apps:u,updateApps:m}}var B=require("react/jsx-runtime");function Z(){let{apps:h}=V({doUpdates:!1});return(0,B.jsx)(C.Form,{actions:(0,B.jsx)(C.ActionPanel,{children:(0,B.jsx)(C.Action.SubmitForm,{title:"Submit",onSubmit:async u=>{if(await(0,C.confirmAlert)({title:"Backup Apps?",message:"Your keys will be stored in plain text, treat the file as sensitive data.",primaryAction:{title:"Backup",style:C.Alert.ActionStyle.Destructive}})){let A=u.folders[0];h.length==0&&(0,C.showToast)(C.Toast.Style.Failure,"No 2FA codes to backup"),(!P.default.existsSync(A)||P.default.lstatSync(A).isDirectory())&&(0,C.showToast)(C.Toast.Style.Failure,"Invalid destination");let m="",t=0;for(let p of h){let U=$(p.name,p.secret,p.options)+`
`;m+=U,t++}let n=`raycast-two-factor-authentication-codes-${new Date().toISOString()}.txt`;try{P.default.writeFileSync(A+"/"+n,m),(0,C.showToast)(C.Toast.Style.Success,`Backed up ${t} app${t>1?"s":""}`)}catch{(0,C.showToast)(C.Toast.Style.Failure,"Unable to create backup")}}}})}),children:(0,B.jsx)(C.Form.FilePicker,{id:"folders",title:"Pick destination",allowMultipleSelection:!1,canChooseDirectories:!0,canChooseFiles:!1})})}
/*! Bundled license information:

hi-base32/src/base32.js:
  (*
   * [hi-base32]{@link https://github.com/emn178/hi-base32}
   *
   * @version 0.5.0
   * @author Chen, Yi-Cyuan [emn178@gmail.com]
   * @copyright Chen, Yi-Cyuan 2015-2018
   * @license MIT
   *)
*/
