"use strict";var q=Object.create;var T=Object.defineProperty;var z=Object.getOwnPropertyDescriptor;var b=Object.getOwnPropertyNames;var ee=Object.getPrototypeOf,te=Object.prototype.hasOwnProperty;var re=(d,u)=>()=>(u||d((u={exports:{}}).exports,u),u.exports),oe=(d,u)=>{for(var C in u)T(d,C,{get:u[C],enumerable:!0})},L=(d,u,C,g)=>{if(u&&typeof u=="object"||typeof u=="function")for(let e of b(u))!te.call(d,e)&&e!==C&&T(d,e,{get:()=>u[e],enumerable:!(g=z(u,e))||g.enumerable});return d};var _=(d,u,C)=>(C=d!=null?q(ee(d)):{},L(u||!d||!d.__esModule?T(C,"default",{value:d,enumerable:!0}):C,d)),ne=d=>L(T({},"__esModule",{value:!0}),d);var N=re((ue,S)=>{(function(){"use strict";var d=typeof window=="object"?window:{},u=!d.HI_BASE32_NO_NODE_JS&&typeof process=="object"&&process.versions&&process.versions.node;u&&(d=global);var C=!d.HI_BASE32_NO_COMMON_JS&&typeof S=="object"&&S.exports,g=typeof define=="function"&&define.amd,e="ABCDEFGHIJKLMNOPQRSTUVWXYZ234567".split(""),i={A:0,B:1,C:2,D:3,E:4,F:5,G:6,H:7,I:8,J:9,K:10,L:11,M:12,N:13,O:14,P:15,Q:16,R:17,S:18,T:19,U:20,V:21,W:22,X:23,Y:24,Z:25,2:26,3:27,4:28,5:29,6:30,7:31},A=[0,0,0,0,0,0,0,0],P=function(t,n){n.length>10&&(n="..."+n.substr(-10));var o=new Error("Decoded data is not valid UTF-8. Maybe try base32.decode.asBytes()? Partial data after reading "+t+" bytes: "+n+" <-");throw o.position=t,o},O=function(t){for(var n="",o=t.length,a=0,p=0,h,s;a<o;){if(h=t[a++],h<=127){n+=String.fromCharCode(h);continue}else h>191&&h<=223?(s=h&31,p=1):h<=239?(s=h&15,p=2):h<=247?(s=h&7,p=3):P(a,n);for(var x=0;x<p;++x)h=t[a++],(h<128||h>191)&&P(a,n),s<<=6,s+=h&63;s>=55296&&s<=57343&&P(a,n),s>1114111&&P(a,n),s<=65535?n+=String.fromCharCode(s):(s-=65536,n+=String.fromCharCode((s>>10)+55296),n+=String.fromCharCode((s&1023)+56320))}return n},D=function(t){if(t==="")return[];if(!/^[A-Z2-7=]+$/.test(t))throw new Error("Invalid base32 characters");t=t.replace(/=/g,"");for(var n,o,a,p,h,s,x,m,v=[],f=0,y=t.length,c=0,F=y>>3<<3;c<F;)n=i[t.charAt(c++)],o=i[t.charAt(c++)],a=i[t.charAt(c++)],p=i[t.charAt(c++)],h=i[t.charAt(c++)],s=i[t.charAt(c++)],x=i[t.charAt(c++)],m=i[t.charAt(c++)],v[f++]=(n<<3|o>>>2)&255,v[f++]=(o<<6|a<<1|p>>>4)&255,v[f++]=(p<<4|h>>>1)&255,v[f++]=(h<<7|s<<2|x>>>3)&255,v[f++]=(x<<5|m)&255;var w=y-F;return w===2?(n=i[t.charAt(c++)],o=i[t.charAt(c++)],v[f++]=(n<<3|o>>>2)&255):w===4?(n=i[t.charAt(c++)],o=i[t.charAt(c++)],a=i[t.charAt(c++)],p=i[t.charAt(c++)],v[f++]=(n<<3|o>>>2)&255,v[f++]=(o<<6|a<<1|p>>>4)&255):w===5?(n=i[t.charAt(c++)],o=i[t.charAt(c++)],a=i[t.charAt(c++)],p=i[t.charAt(c++)],h=i[t.charAt(c++)],v[f++]=(n<<3|o>>>2)&255,v[f++]=(o<<6|a<<1|p>>>4)&255,v[f++]=(p<<4|h>>>1)&255):w===7&&(n=i[t.charAt(c++)],o=i[t.charAt(c++)],a=i[t.charAt(c++)],p=i[t.charAt(c++)],h=i[t.charAt(c++)],s=i[t.charAt(c++)],x=i[t.charAt(c++)],v[f++]=(n<<3|o>>>2)&255,v[f++]=(o<<6|a<<1|p>>>4)&255,v[f++]=(p<<4|h>>>1)&255,v[f++]=(h<<7|s<<2|x>>>3)&255),v},W=function(t){for(var n,o,a,p,h,s="",x=t.length,m=0,v=parseInt(x/5)*5;m<v;)n=t.charCodeAt(m++),o=t.charCodeAt(m++),a=t.charCodeAt(m++),p=t.charCodeAt(m++),h=t.charCodeAt(m++),s+=e[n>>>3]+e[(n<<2|o>>>6)&31]+e[o>>>1&31]+e[(o<<4|a>>>4)&31]+e[(a<<1|p>>>7)&31]+e[p>>>2&31]+e[(p<<3|h>>>5)&31]+e[h&31];var f=x-v;return f===1?(n=t.charCodeAt(m),s+=e[n>>>3]+e[n<<2&31]+"======"):f===2?(n=t.charCodeAt(m++),o=t.charCodeAt(m),s+=e[n>>>3]+e[(n<<2|o>>>6)&31]+e[o>>>1&31]+e[o<<4&31]+"===="):f===3?(n=t.charCodeAt(m++),o=t.charCodeAt(m++),a=t.charCodeAt(m),s+=e[n>>>3]+e[(n<<2|o>>>6)&31]+e[o>>>1&31]+e[(o<<4|a>>>4)&31]+e[a<<1&31]+"==="):f===4&&(n=t.charCodeAt(m++),o=t.charCodeAt(m++),a=t.charCodeAt(m++),p=t.charCodeAt(m),s+=e[n>>>3]+e[(n<<2|o>>>6)&31]+e[o>>>1&31]+e[(o<<4|a>>>4)&31]+e[(a<<1|p>>>7)&31]+e[p>>>2&31]+e[p<<3&31]+"="),s},X=function(t){var n,o,a,p,h,s,x=!1,m="",v=0,f,y=0,c=0,F=t.length;if(t==="")return m;do{for(A[0]=A[5],A[1]=A[6],A[2]=A[7],f=y;v<F&&f<5;++v)s=t.charCodeAt(v),s<128?A[f++]=s:s<2048?(A[f++]=192|s>>6,A[f++]=128|s&63):s<55296||s>=57344?(A[f++]=224|s>>12,A[f++]=128|s>>6&63,A[f++]=128|s&63):(s=65536+((s&1023)<<10|t.charCodeAt(++v)&1023),A[f++]=240|s>>18,A[f++]=128|s>>12&63,A[f++]=128|s>>6&63,A[f++]=128|s&63);c+=f-y,y=f-5,v===F&&++v,v>F&&f<6&&(x=!0),n=A[0],f>4?(o=A[1],a=A[2],p=A[3],h=A[4],m+=e[n>>>3]+e[(n<<2|o>>>6)&31]+e[o>>>1&31]+e[(o<<4|a>>>4)&31]+e[(a<<1|p>>>7)&31]+e[p>>>2&31]+e[(p<<3|h>>>5)&31]+e[h&31]):f===1?m+=e[n>>>3]+e[n<<2&31]+"======":f===2?(o=A[1],m+=e[n>>>3]+e[(n<<2|o>>>6)&31]+e[o>>>1&31]+e[o<<4&31]+"===="):f===3?(o=A[1],a=A[2],m+=e[n>>>3]+e[(n<<2|o>>>6)&31]+e[o>>>1&31]+e[(o<<4|a>>>4)&31]+e[a<<1&31]+"==="):(o=A[1],a=A[2],p=A[3],m+=e[n>>>3]+e[(n<<2|o>>>6)&31]+e[o>>>1&31]+e[(o<<4|a>>>4)&31]+e[(a<<1|p>>>7)&31]+e[p>>>2&31]+e[p<<3&31]+"=")}while(!x);return m},j=function(t){for(var n,o,a,p,h,s="",x=t.length,m=0,v=parseInt(x/5)*5;m<v;)n=t[m++],o=t[m++],a=t[m++],p=t[m++],h=t[m++],s+=e[n>>>3]+e[(n<<2|o>>>6)&31]+e[o>>>1&31]+e[(o<<4|a>>>4)&31]+e[(a<<1|p>>>7)&31]+e[p>>>2&31]+e[(p<<3|h>>>5)&31]+e[h&31];var f=x-v;return f===1?(n=t[m],s+=e[n>>>3]+e[n<<2&31]+"======"):f===2?(n=t[m++],o=t[m],s+=e[n>>>3]+e[(n<<2|o>>>6)&31]+e[o>>>1&31]+e[o<<4&31]+"===="):f===3?(n=t[m++],o=t[m++],a=t[m],s+=e[n>>>3]+e[(n<<2|o>>>6)&31]+e[o>>>1&31]+e[(o<<4|a>>>4)&31]+e[a<<1&31]+"==="):f===4&&(n=t[m++],o=t[m++],a=t[m++],p=t[m],s+=e[n>>>3]+e[(n<<2|o>>>6)&31]+e[o>>>1&31]+e[(o<<4|a>>>4)&31]+e[(a<<1|p>>>7)&31]+e[p>>>2&31]+e[p<<3&31]+"="),s},Q=function(t,n){var o=typeof t!="string";return o&&t.constructor===ArrayBuffer&&(t=new Uint8Array(t)),o?j(t):n?W(t):X(t)},R=function(t,n){if(!n)return O(D(t));if(t==="")return"";if(!/^[A-Z2-7=]+$/.test(t))throw new Error("Invalid base32 characters");var o,a,p,h,s,x,m,v,f="",y=t.indexOf("=");y===-1&&(y=t.length);for(var c=0,F=y>>3<<3;c<F;)o=i[t.charAt(c++)],a=i[t.charAt(c++)],p=i[t.charAt(c++)],h=i[t.charAt(c++)],s=i[t.charAt(c++)],x=i[t.charAt(c++)],m=i[t.charAt(c++)],v=i[t.charAt(c++)],f+=String.fromCharCode((o<<3|a>>>2)&255)+String.fromCharCode((a<<6|p<<1|h>>>4)&255)+String.fromCharCode((h<<4|s>>>1)&255)+String.fromCharCode((s<<7|x<<2|m>>>3)&255)+String.fromCharCode((m<<5|v)&255);var w=y-F;return w===2?(o=i[t.charAt(c++)],a=i[t.charAt(c++)],f+=String.fromCharCode((o<<3|a>>>2)&255)):w===4?(o=i[t.charAt(c++)],a=i[t.charAt(c++)],p=i[t.charAt(c++)],h=i[t.charAt(c++)],f+=String.fromCharCode((o<<3|a>>>2)&255)+String.fromCharCode((a<<6|p<<1|h>>>4)&255)):w===5?(o=i[t.charAt(c++)],a=i[t.charAt(c++)],p=i[t.charAt(c++)],h=i[t.charAt(c++)],s=i[t.charAt(c++)],f+=String.fromCharCode((o<<3|a>>>2)&255)+String.fromCharCode((a<<6|p<<1|h>>>4)&255)+String.fromCharCode((h<<4|s>>>1)&255)):w===7&&(o=i[t.charAt(c++)],a=i[t.charAt(c++)],p=i[t.charAt(c++)],h=i[t.charAt(c++)],s=i[t.charAt(c++)],x=i[t.charAt(c++)],m=i[t.charAt(c++)],f+=String.fromCharCode((o<<3|a>>>2)&255)+String.fromCharCode((a<<6|p<<1|h>>>4)&255)+String.fromCharCode((h<<4|s>>>1)&255)+String.fromCharCode((s<<7|x<<2|m>>>3)&255)),f},k={encode:Q,decode:R};R.asBytes=D,C?S.exports=k:(d.base32=k,g&&define(function(){return k}))})()});var fe={};oe(fe,{default:()=>E});module.exports=ne(fe);var r=require("@raycast/api"),$=_(N());var V=require("crypto"),H=_(N()),ie=[6,7,8],ae=["SHA1","SHA256","SHA512"],B={digits:6,algorithm:"SHA1",period:30};function se(d){return!!ae.find(u=>u===d)}function ce(d){return!!ie.find(u=>u==d)}function le(d,u,C){let g=(0,V.createHmac)(C,d),e=Buffer.alloc(8);return e.writeBigInt64BE(u),g.update(e),g.digest()}function de(d,u){let C=d[d.length-1]&15;return(d.slice(C,C+4).readUInt32BE()&2147483647)%Math.pow(10,u)}function M(d,u){let C=Math.floor(new Date().getTime()/1e3/u.period),g=H.decode.asBytes(d.toUpperCase());return de(le(Buffer.from(g),BigInt(C),u.algorithm),u.digits)}function U(d){try{return JSON.parse(d)}catch{return{secret:d,options:B,lastTimeUsed:new Date().getTime()}}}function J(d){try{let u=new URL(d);if(u.protocol!=="otpauth:")return{success:!1,data:"Unsupported protocol "+u.protocol};if(u.host!=="totp")return{success:!1,data:"Unsupported type "+u.host+" only TOTP supported"};if(!u.pathname)return{success:!1,data:"Label is missing"};let C=decodeURIComponent(u.pathname.slice(1)),g=u.searchParams,e=g.get("secret"),i=g.get("algorithm")?g.get("algorithm"):B.algorithm,A=g.get("period"),P=A?parseInt(A):B.period,O=g.get("digits")?g.get("digits"):B.digits;if(!e)return{success:!1,data:"Secret is mandatory"};try{H.decode.asBytes(e)}catch{return{success:!1,data:"Invalid 2FA secret"}}return se(i)?isNaN(P)||P<=0?{success:!1,data:"Period should be a positive number"}:ce(O)?{success:!0,data:{name:C,data:{secret:e,options:{digits:O,period:P,algorithm:i}}}}:{success:!1,data:"Unsupported digits "+O}:{success:!1,data:"Unsupported hashing algorithm "+i}}catch{return{success:!1,data:"Unable to parse URL"}}}var K=require("@raycast/api"),I=require("react");function G(d){let[u,C]=(0,I.useState)([]);async function g(){let e=await K.LocalStorage.allItems();C(Object.keys(e).sort((i,A)=>{let P=U(e[i]).lastTimeUsed??1,D=(U(e[A]).lastTimeUsed??1)-P;return D===0?i.localeCompare(A):D}).map(i=>{let A=U(e[i]);return{name:i,key:e[i].toString(),time:`${Math.floor(A.options.period-new Date().getTime()/1e3%A.options.period)}`,percent:Math.floor(A.options.period-new Date().getTime()/1e3%A.options.period)/A.options.period*100,code:M(A.secret,A.options).toString().padStart(A.options.digits,"0"),secret:A.secret,options:A.options}}))}return(0,I.useEffect)(()=>{g()},[]),(0,I.useEffect)(()=>{if(d?.doUpdates!==!1){g();let e=setInterval(g,100);return()=>clearInterval(e)}},[d?.doUpdates]),{apps:u,updateApps:g}}var l=require("react/jsx-runtime");function E(){let{apps:d,updateApps:u}=G(),{defaultAction:C}=(0,r.getPreferenceValues)(),g=async e=>{let i=await r.LocalStorage.getItem(e.name),A={...U(i),lastTimeUsed:new Date().getTime()};await r.LocalStorage.setItem(e.name,JSON.stringify(A))};return(0,l.jsx)(r.List,{actions:(0,l.jsxs)(r.ActionPanel,{children:[(0,l.jsx)(r.Action.Push,{icon:r.Icon.Plus,title:"Add App",target:(0,l.jsx)(Y,{}),shortcut:{modifiers:["cmd"],key:"g"}}),(0,l.jsx)(r.Action.Push,{icon:r.Icon.Link,title:"Add App by URL",target:(0,l.jsx)(Z,{}),shortcut:{modifiers:["cmd"],key:"u"}})]}),children:d.map(e=>(0,l.jsx)(r.List.Item,{title:e.name,subtitle:e.code,accessories:[{icon:{source:+e.percent>75?r.Icon.CircleProgress100:+e.percent>50?r.Icon.CircleProgress75:+e.percent>25?r.Icon.CircleProgress50:+e.time>0?r.Icon.CircleProgress25:r.Icon.Circle},tooltip:e.time}],actions:(0,l.jsxs)(r.ActionPanel,{children:[(0,l.jsx)(r.ActionPanel.Section,{children:C=="copy"?(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(r.Action.CopyToClipboard,{content:e.code,title:"Copy Code",onCopy:()=>g(e)}),(0,l.jsx)(r.Action.Paste,{content:e.code,title:"Paste Code",onPaste:()=>g(e)})]}):(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(r.Action.Paste,{content:e.code,title:"Paste Code",onPaste:()=>g(e)}),(0,l.jsx)(r.Action.CopyToClipboard,{content:e.code,title:"Copy Code",onCopy:()=>g(e)})]})}),(0,l.jsxs)(r.ActionPanel.Section,{children:[(0,l.jsx)(r.Action.Push,{icon:r.Icon.Plus,title:"Add App",target:(0,l.jsx)(Y,{}),shortcut:{modifiers:["cmd"],key:"g"}}),(0,l.jsx)(r.Action.Push,{icon:r.Icon.Link,title:"Add App by URL",target:(0,l.jsx)(Z,{}),shortcut:{modifiers:["cmd"],key:"u"}})]}),(0,l.jsxs)(r.ActionPanel.Section,{children:[(0,l.jsx)(r.Action,{icon:r.Icon.Trash,title:"Remove App",onAction:async()=>{await(0,r.confirmAlert)({title:"Remove App?",message:"Your key will be lost forever, unless you've performed a backup.",primaryAction:{title:"Remove",style:r.Alert.ActionStyle.Destructive}})&&(await r.LocalStorage.removeItem(e.name),await u())},shortcut:{modifiers:["ctrl"],key:"return"}}),(0,l.jsx)(r.Action.Push,{icon:r.Icon.Pencil,title:"Edit App",target:(0,l.jsx)(pe,{app:e}),shortcut:r.Keyboard.Shortcut.Common.Edit})]})]})},e.name))})}function Y(){let{push:d}=(0,r.useNavigation)(),u=async C=>{let g=C;if(!g.name||!g.secret){(0,r.showToast)(r.Toast.Style.Failure,"Please provide both fields");return}if(g.secret=g.secret.replace(/[-\s]/g,"").toUpperCase(),await r.LocalStorage.getItem(g.name)){(0,r.showToast)(r.Toast.Style.Failure,"This app name is already taken");return}try{$.decode.asBytes(g.secret)}catch{(0,r.showToast)(r.Toast.Style.Failure,"Invalid 2FA secret");return}if(isNaN(g.period)){(0,r.showToast)(r.Toast.Style.Failure,"Period should be a number");return}if(+g.period<=0){(0,r.showToast)(r.Toast.Style.Failure,"Period should be positive number");return}let e={digits:g.digits,period:g.period,algorithm:g.algorithm};await r.LocalStorage.setItem(g.name,JSON.stringify({secret:g.secret,options:e,lastTimeUsed:new Date().getTime()})),d((0,l.jsx)(E,{}))};return(0,l.jsxs)(r.Form,{actions:(0,l.jsx)(r.ActionPanel,{children:(0,l.jsx)(r.Action.SubmitForm,{icon:r.Icon.Plus,title:"Submit",onSubmit:u})}),children:[(0,l.jsx)(r.Form.TextField,{id:"name",title:"App Name",placeholder:"e.g. GitHub"}),(0,l.jsx)(r.Form.TextField,{id:"secret",title:"2FA Secret",placeholder:"Get this from your provider"}),(0,l.jsx)(r.Form.TextField,{id:"period",title:"Period",placeholder:"A period that a TOTP code will be valid for",defaultValue:"30"}),(0,l.jsxs)(r.Form.Dropdown,{id:"digits",title:"Digits count",defaultValue:"6",children:[(0,l.jsx)(r.Form.Dropdown.Item,{title:"6",value:"6"}),(0,l.jsx)(r.Form.Dropdown.Item,{title:"7",value:"7"}),(0,l.jsx)(r.Form.Dropdown.Item,{title:"8",value:"8"})]}),(0,l.jsxs)(r.Form.Dropdown,{id:"algorithm",title:"Algorithm",defaultValue:"SHA1",children:[(0,l.jsx)(r.Form.Dropdown.Item,{title:"SHA1",value:"SHA1"}),(0,l.jsx)(r.Form.Dropdown.Item,{title:"SHA256",value:"SHA256"}),(0,l.jsx)(r.Form.Dropdown.Item,{title:"SHA512",value:"SHA512"})]})]})}function Z(){let{push:d}=(0,r.useNavigation)(),u=async C=>{let{url:g}=C;if(!g){(0,r.showToast)(r.Toast.Style.Failure,"Please provide both fields");return}let e=J(g);if(!e.success){(0,r.showToast)(r.Toast.Style.Failure,e.data);return}await r.LocalStorage.setItem(e.data.name,JSON.stringify(e.data.data)),d((0,l.jsx)(E,{}))};return(0,l.jsx)(r.Form,{actions:(0,l.jsx)(r.ActionPanel,{children:(0,l.jsx)(r.Action.SubmitForm,{icon:r.Icon.Plus,title:"Submit",onSubmit:u})}),children:(0,l.jsx)(r.Form.TextArea,{id:"url",title:"Otpauth URL",placeholder:"e.g. otpauth://totp/Example:alice@google.com?secret=JBSWY3DPEHPK3PXP&issuer=Example"})})}function pe({app:d}){let{pop:u}=(0,r.useNavigation)(),C=async g=>{let{name:e}=g;if(!e){(0,r.showToast)(r.Toast.Style.Failure,"Please provide name");return}if(await r.LocalStorage.getItem(e)){(0,r.showToast)(r.Toast.Style.Failure,"This app name is already taken");return}let i=await r.LocalStorage.getItem(d.name);await r.LocalStorage.removeItem(d.name),await r.LocalStorage.setItem(e,i),u()};return(0,l.jsxs)(r.Form,{actions:(0,l.jsx)(r.ActionPanel,{children:(0,l.jsx)(r.Action.SubmitForm,{icon:r.Icon.Pencil,title:"Submit",onSubmit:C})}),children:[(0,l.jsx)(r.Form.TextField,{id:"name",title:"App Name",placeholder:d.name,defaultValue:d.name}),(0,l.jsx)(r.Form.Description,{title:"\u26A0\uFE0F",text:"To prevent loss of data, please Backup your codes first"})]})}
/*! Bundled license information:

hi-base32/src/base32.js:
  (*
   * [hi-base32]{@link https://github.com/emn178/hi-base32}
   *
   * @version 0.5.0
   * @author Chen, Yi-Cyuan [emn178@gmail.com]
   * @copyright Chen, Yi-Cyuan 2015-2018
   * @license MIT
   *)
*/
