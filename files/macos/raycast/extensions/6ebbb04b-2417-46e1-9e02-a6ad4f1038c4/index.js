"use strict";var a=Object.defineProperty;var d=Object.getOwnPropertyDescriptor;var u=Object.getOwnPropertyNames;var f=Object.prototype.hasOwnProperty;var h=(n,e)=>{for(var t in e)a(n,t,{get:e[t],enumerable:!0})},p=(n,e,t,s)=>{if(e&&typeof e=="object"||typeof e=="function")for(let i of u(e))!f.call(n,i)&&i!==t&&a(n,i,{get:()=>e[i],enumerable:!(s=d(e,i))||s.enumerable});return n};var S=n=>p(a({},"__esModule",{value:!0}),n);var N={};h(N,{default:()=>m});module.exports=S(N);var r=require("@raycast/api"),c=require("node:child_process"),l=require("node:os"),g={darwin:{commands:{dscacheutil:"/usr/bin/dscacheutil -flushcache",mDNSResponder:"/usr/bin/killall -HUP mDNSResponder",mdnsflushcache:"/usr/bin/discoveryutil mdnsflushcache"},shell:"/bin/bash"},win32:{commands:{ipconfig:"ipconfig /flushdns"},shell:void 0}};async function m(){let n=(0,l.platform)();if(!["darwin","win32"].includes(n)){await(0,r.showHUD)("\u{1F6AB} Unsupported operating system");return}let e=g[n],t,s;switch(n){case"darwin":{let i=await w(e);if(!i)return;t=i.command,s=i.shell;break}case"win32":{let{ipconfig:i}=e.commands;t=i,s=e.shell;break}default:await(0,r.showHUD)("\u{1F6AB} Unsupported OS");return}console.log(`\u{1F680} Executing DNS flush command: ${t} in shell: ${s}`);try{(0,c.execSync)(t,{shell:s,stdio:"ignore"}),await(0,r.showHUD)("\u2705 DNS Cache Flushed Successfully")}catch(i){await y(i,n)}}async function w(n){try{let e=(0,c.execSync)("sw_vers -productVersion").toString().trim(),[t]=e.split(".").map(Number),s;if(Number.isNaN(t))throw new Error(`Unparsable macOS version: ${e}`);if(t>=11)s=["dscacheutil","mDNSResponder"];else if(t===10){let o=Number(e.split(".")[1]);o>=10?s=["mDNSResponder"]:o===6?s=["dscacheutil"]:s=["mdnsflushcache"]}else{if(!await(0,r.confirmAlert)({title:`\u26A0\uFE0F OS Version ${e} Not Tested`,message:"Attempt to flush DNS cache anyway?",primaryAction:{title:"Flush DNS"}}))return null;s=["dscacheutil","mDNSResponder"]}return{command:`osascript -e 'do shell script "${s.map(o=>n.commands[o]).join("; ")}" with administrator privileges'`,shell:n.shell}}catch(e){return console.error("\u274C Error determining macOS version:",e),await(0,r.showHUD)("Failed to determine macOS version"),null}}async function y(n,e){let t="\u26A0\uFE0F Error flushing DNS cache";if(typeof n=="object"&&n!==null&&"stderr"in n){let s=n.stderr?.toString()||"";s&&(console.error(".Stderr:",s),e==="win32"&&s.includes("The requested operation requires elevation")?t="\u26A0\uFE0F Run Raycast as Administrator":t=s.split(`
`)[0].substring(0,64))}console.error("\u{1F4A5} Execution failed:",n),await(0,r.showHUD)(t)}
