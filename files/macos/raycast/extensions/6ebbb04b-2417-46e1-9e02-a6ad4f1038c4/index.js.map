{
  "version": 3,
  "sources": ["../src/index.ts"],
  "sourcesContent": ["import { confirmAlert, showHUD } from \"@raycast/api\";\nimport { execSync } from \"node:child_process\";\nimport { platform } from \"node:os\";\n\ntype ShellType = string | undefined;\n\ninterface CommandSet {\n  commands: Record<string, string>;\n  shell: ShellType;\n}\n\nconst OS_COMMANDS = {\n  darwin: {\n    commands: {\n      dscacheutil: \"/usr/bin/dscacheutil -flushcache\",\n      mDNSResponder: \"/usr/bin/killall -HUP mDNSResponder\",\n      mdnsflushcache: \"/usr/bin/discoveryutil mdnsflushcache\",\n    },\n    shell: \"/bin/bash\",\n  },\n  win32: {\n    commands: {\n      ipconfig: \"ipconfig /flushdns\",\n    },\n    shell: undefined, // Uses cmd.exe by default\n  },\n} as const satisfies Record<string, CommandSet>;\n\ntype SupportedPlatform = \"darwin\" | \"win32\";\n\ninterface Win32Commands {\n  ipconfig: string;\n}\n\nexport default async function main() {\n  const osPlatform = platform();\n\n  if (![\"darwin\", \"win32\"].includes(osPlatform)) {\n    await showHUD(\"\uD83D\uDEAB Unsupported operating system\");\n    return;\n  }\n\n  const osCommandSet = OS_COMMANDS[osPlatform as SupportedPlatform];\n\n  let command: string;\n  let shell: ShellType;\n\n  switch (osPlatform) {\n    case \"darwin\": {\n      const macResult = await getMacOSCommands(osCommandSet);\n      if (!macResult) return;\n\n      command = macResult.command;\n      shell = macResult.shell;\n      break;\n    }\n\n    case \"win32\": {\n      const { ipconfig } = osCommandSet.commands as Win32Commands;\n      command = ipconfig;\n      shell = osCommandSet.shell;\n      break;\n    }\n\n    default:\n      await showHUD(\"\uD83D\uDEAB Unsupported OS\");\n      return;\n  }\n\n  console.log(`\uD83D\uDE80 Executing DNS flush command: ${command} in shell: ${shell}`);\n\n  try {\n    execSync(command, { shell, stdio: \"ignore\" });\n    await showHUD(\"\u2705 DNS Cache Flushed Successfully\");\n  } catch (error) {\n    await handleExecutionError(error, osPlatform);\n  }\n}\n\nasync function getMacOSCommands(osCommandSet: CommandSet): Promise<{ command: string; shell: ShellType } | null> {\n  try {\n    const osVersion = execSync(\"sw_vers -productVersion\").toString().trim();\n\n    const [major] = osVersion.split(\".\").map(Number);\n\n    let runCommands: string[];\n\n    if (Number.isNaN(major)) {\n      throw new Error(`Unparsable macOS version: ${osVersion}`);\n    }\n\n    // macOS 11+ (Big Sur \u2192 future)\n    if (major >= 11) {\n      runCommands = [\"dscacheutil\", \"mDNSResponder\"];\n    }\n    // macOS 10.4 - 10.15.7\n    else if (major === 10) {\n      const minor = Number(osVersion.split(\".\")[1]);\n\n      if (minor >= 10) {\n        runCommands = [\"mDNSResponder\"];\n      } else if (minor === 6) {\n        runCommands = [\"dscacheutil\"];\n      } else {\n        runCommands = [\"mdnsflushcache\"];\n      }\n    } else {\n      const confirmed = await confirmAlert({\n        title: `\u26A0\uFE0F OS Version ${osVersion} Not Tested`,\n        message: \"Attempt to flush DNS cache anyway?\",\n        primaryAction: { title: \"Flush DNS\" },\n      });\n\n      if (!confirmed) return null;\n      runCommands = [\"dscacheutil\", \"mDNSResponder\"];\n    }\n\n    const commandList = runCommands.map((key) => osCommandSet.commands[key]).join(\"; \");\n    return {\n      command: `osascript -e 'do shell script \"${commandList}\" with administrator privileges'`,\n      shell: osCommandSet.shell,\n    };\n  } catch (e) {\n    console.error(\"\u274C Error determining macOS version:\", e);\n    await showHUD(\"Failed to determine macOS version\");\n    return null;\n  }\n}\n\nasync function handleExecutionError(error: unknown, os: string) {\n  let errorMessage = \"\u26A0\uFE0F Error flushing DNS cache\";\n\n  if (typeof error === \"object\" && error !== null && \"stderr\" in error) {\n    const stderr = (error as { stderr?: Buffer }).stderr?.toString() || \"\";\n    if (stderr) {\n      console.error(\".Stderr:\", stderr);\n      if (os === \"win32\" && stderr.includes(\"The requested operation requires elevation\")) {\n        errorMessage = \"\u26A0\uFE0F Run Raycast as Administrator\";\n      } else {\n        errorMessage = stderr.split(\"\\n\")[0].substring(0, 64);\n      }\n    }\n  }\n\n  console.error(\"\uD83D\uDCA5 Execution failed:\", error);\n  await showHUD(errorMessage);\n}\n"],
  "mappings": "yaAAA,IAAAA,EAAA,GAAAC,EAAAD,EAAA,aAAAE,IAAA,eAAAC,EAAAH,GAAA,IAAAI,EAAsC,wBACtCC,EAAyB,8BACzBC,EAAyB,mBASnBC,EAAc,CAClB,OAAQ,CACN,SAAU,CACR,YAAa,mCACb,cAAe,sCACf,eAAgB,uCAClB,EACA,MAAO,WACT,EACA,MAAO,CACL,SAAU,CACR,SAAU,oBACZ,EACA,MAAO,MACT,CACF,EAQA,eAAOL,GAA8B,CACnC,IAAMM,KAAa,YAAS,EAE5B,GAAI,CAAC,CAAC,SAAU,OAAO,EAAE,SAASA,CAAU,EAAG,CAC7C,QAAM,WAAQ,wCAAiC,EAC/C,MACF,CAEA,IAAMC,EAAeF,EAAYC,CAA+B,EAE5DE,EACAC,EAEJ,OAAQH,EAAY,CAClB,IAAK,SAAU,CACb,IAAMI,EAAY,MAAMC,EAAiBJ,CAAY,EACrD,GAAI,CAACG,EAAW,OAEhBF,EAAUE,EAAU,QACpBD,EAAQC,EAAU,MAClB,KACF,CAEA,IAAK,QAAS,CACZ,GAAM,CAAE,SAAAE,CAAS,EAAIL,EAAa,SAClCC,EAAUI,EACVH,EAAQF,EAAa,MACrB,KACF,CAEA,QACE,QAAM,WAAQ,0BAAmB,EACjC,MACJ,CAEA,QAAQ,IAAI,0CAAmCC,CAAO,cAAcC,CAAK,EAAE,EAE3E,GAAI,IACF,YAASD,EAAS,CAAE,MAAAC,EAAO,MAAO,QAAS,CAAC,EAC5C,QAAM,WAAQ,uCAAkC,CAClD,OAASI,EAAO,CACd,MAAMC,EAAqBD,EAAOP,CAAU,CAC9C,CACF,CAEA,eAAeK,EAAiBJ,EAAiF,CAC/G,GAAI,CACF,IAAMQ,KAAY,YAAS,yBAAyB,EAAE,SAAS,EAAE,KAAK,EAEhE,CAACC,CAAK,EAAID,EAAU,MAAM,GAAG,EAAE,IAAI,MAAM,EAE3CE,EAEJ,GAAI,OAAO,MAAMD,CAAK,EACpB,MAAM,IAAI,MAAM,6BAA6BD,CAAS,EAAE,EAI1D,GAAIC,GAAS,GACXC,EAAc,CAAC,cAAe,eAAe,UAGtCD,IAAU,GAAI,CACrB,IAAME,EAAQ,OAAOH,EAAU,MAAM,GAAG,EAAE,CAAC,CAAC,EAExCG,GAAS,GACXD,EAAc,CAAC,eAAe,EACrBC,IAAU,EACnBD,EAAc,CAAC,aAAa,EAE5BA,EAAc,CAAC,gBAAgB,CAEnC,KAAO,CAOL,GAAI,CANc,QAAM,gBAAa,CACnC,MAAO,2BAAiBF,CAAS,cACjC,QAAS,qCACT,cAAe,CAAE,MAAO,WAAY,CACtC,CAAC,EAEe,OAAO,KACvBE,EAAc,CAAC,cAAe,eAAe,CAC/C,CAGA,MAAO,CACL,QAAS,kCAFSA,EAAY,IAAKE,GAAQZ,EAAa,SAASY,CAAG,CAAC,EAAE,KAAK,IAAI,CAE1B,mCACtD,MAAOZ,EAAa,KACtB,CACF,OAAS,EAAG,CACV,eAAQ,MAAM,0CAAsC,CAAC,EACrD,QAAM,WAAQ,mCAAmC,EAC1C,IACT,CACF,CAEA,eAAeO,EAAqBD,EAAgBO,EAAY,CAC9D,IAAIC,EAAe,wCAEnB,GAAI,OAAOR,GAAU,UAAYA,IAAU,MAAQ,WAAYA,EAAO,CACpE,IAAMS,EAAUT,EAA8B,QAAQ,SAAS,GAAK,GAChES,IACF,QAAQ,MAAM,WAAYA,CAAM,EAC5BF,IAAO,SAAWE,EAAO,SAAS,4CAA4C,EAChFD,EAAe,4CAEfA,EAAeC,EAAO,MAAM;AAAA,CAAI,EAAE,CAAC,EAAE,UAAU,EAAG,EAAE,EAG1D,CAEA,QAAQ,MAAM,8BAAwBT,CAAK,EAC3C,QAAM,WAAQQ,CAAY,CAC5B",
  "names": ["index_exports", "__export", "main", "__toCommonJS", "import_api", "import_node_child_process", "import_node_os", "OS_COMMANDS", "osPlatform", "osCommandSet", "command", "shell", "macResult", "getMacOSCommands", "ipconfig", "error", "handleExecutionError", "osVersion", "major", "runCommands", "minor", "key", "os", "errorMessage", "stderr"]
}
