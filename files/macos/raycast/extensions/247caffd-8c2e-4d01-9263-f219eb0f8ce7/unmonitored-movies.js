"use strict";var de=Object.create;var V=Object.defineProperty;var he=Object.getOwnPropertyDescriptor;var pe=Object.getOwnPropertyNames;var me=Object.getPrototypeOf,ge=Object.prototype.hasOwnProperty;var be=(e,n)=>{for(var t in n)V(e,t,{get:n[t],enumerable:!0})},Z=(e,n,t,r)=>{if(n&&typeof n=="object"||typeof n=="function")for(let a of pe(n))!ge.call(e,a)&&a!==t&&V(e,a,{get:()=>n[a],enumerable:!(r=he(n,a))||r.enumerable});return e};var W=(e,n,t)=>(t=e!=null?de(me(e)):{},Z(n||!e||!e.__esModule?V(t,"default",{value:e,enumerable:!0}):t,e)),ye=e=>Z(V({},"__esModule",{value:!0}),e);var De={};be(De,{default:()=>le});module.exports=ye(De);var ce=require("react"),s=require("@raycast/api");var P=require("react");var H=require("@raycast/api");function J(){let e=(0,H.getPreferenceValues)(),n=[];if(!e.primaryInstanceName||!e.primaryInstanceUrl||!e.primaryInstanceApiKey)throw new Error("Primary Radarr instance configuration is incomplete");return n.push({name:e.primaryInstanceName,url:e.primaryInstanceUrl.replace(/\/$/,""),apiKey:e.primaryInstanceApiKey,isDefault:!0}),e.enableSecondaryInstance&&e.secondaryInstanceName&&e.secondaryInstanceUrl&&e.secondaryInstanceApiKey&&n.push({name:e.secondaryInstanceName,url:e.secondaryInstanceUrl.replace(/\/$/,""),apiKey:e.secondaryInstanceApiKey,isDefault:!1}),n}function q(){let e=(0,H.getPreferenceValues)(),n=J();if(e.activeInstance==="secondary"&&e.enableSecondaryInstance&&n.length>1)return n[1];if(n.length>0)return n[0];throw new Error("No Radarr instances configured")}function X(){let[e,n]=(0,P.useState)(null),[t,r]=(0,P.useState)(!0),a=(0,P.useCallback)(()=>{try{let o=q();n(o)}catch(o){console.error("Failed to load default instance:",o),n(null)}finally{r(!1)}},[]);(0,P.useEffect)(()=>{a()},[a]);let u=(0,P.useCallback)(o=>{n(o)},[]),i=(0,P.useMemo)(()=>{try{return J()}catch{return[]}},[]);return{currentInstance:e,isLoading:t,availableInstances:i,switchToInstance:u}}var l=W(require("react")),m=require("@raycast/api");var Q=Object.prototype.hasOwnProperty;function j(e,n){var t,r;if(e===n)return!0;if(e&&n&&(t=e.constructor)===n.constructor){if(t===Date)return e.getTime()===n.getTime();if(t===RegExp)return e.toString()===n.toString();if(t===Array){if((r=e.length)===n.length)for(;r--&&j(e[r],n[r]););return r===-1}if(!t||typeof e=="object"){r=0;for(t in e)if(Q.call(e,t)&&++r&&!Q.call(n,t)||!(t in n)||!j(e[t],n[t]))return!1;return Object.keys(n).length===r}}return e!==e&&n!==n}var M=W(require("node:fs")),B=W(require("node:path")),re=W(require("node:crypto"));var ne=require("react/jsx-runtime");function $e(e){let n=(0,l.useRef)(e),t=(0,l.useRef)(0);return j(e,n.current)||(n.current=e,t.current+=1),(0,l.useMemo)(()=>n.current,[t.current])}function S(e){let n=(0,l.useRef)(e);return n.current=e,n}function we(e,n){let t=e instanceof Error?e.message:String(e);return(0,m.showToast)({style:m.Toast.Style.Failure,title:n?.title??"Something went wrong",message:n?.message??t,primaryAction:n?.primaryAction??Y(e),secondaryAction:n?.primaryAction?Y(e):void 0})}var Y=e=>{let n=!0,t="[Extension Name]...",r="";try{let i=JSON.parse((0,M.readFileSync)((0,B.join)(m.environment.assetsPath,"..","package.json"),"utf8"));t=`[${i.title}]...`,r=`https://raycast.com/${i.owner||i.author}/${i.name}`,(!i.owner||i.access==="public")&&(n=!1)}catch{}let a=m.environment.isDevelopment||n,u=e instanceof Error?e?.stack||e?.message||"":String(e);return{title:a?"Copy Logs":"Report Error",onAction(i){i.hide(),a?m.Clipboard.copy(u):(0,m.open)(`https://github.com/raycast/extensions/issues/new?&labels=extension%2Cbug&template=extension_bug_report.yml&title=${encodeURIComponent(t)}&extension-url=${encodeURI(r)}&description=${encodeURIComponent(`#### Error:
\`\`\`
${u}
\`\`\`
`)}`)}}};function ke(e,n,t){let r=(0,l.useRef)(0),[a,u]=(0,l.useState)({isLoading:!0}),i=S(e),o=S(t?.abortable),c=S(n||[]),g=S(t?.onError),b=S(t?.onData),k=S(t?.onWillExecute),v=S(t?.failureToastOptions),f=S(a.data),$=(0,l.useRef)(null),p=(0,l.useRef)({page:0}),x=(0,l.useRef)(!1),E=(0,l.useRef)(!0),I=(0,l.useRef)(50),w=(0,l.useCallback)(()=>(o.current&&(o.current.current?.abort(),o.current.current=new AbortController),++r.current),[o]),y=(0,l.useCallback)((...U)=>{let R=w();k.current?.(U),u(d=>({...d,isLoading:!0}));let O=xe(i.current)(...U);function D(d){return d.name=="AbortError"||R===r.current&&(g.current?g.current(d):m.environment.launchType!==m.LaunchType.Background&&we(d,{title:"Failed to fetch latest data",primaryAction:{title:"Retry",onAction(_){_.hide(),$.current?.(...c.current||[])}},...v.current}),u({error:d,isLoading:!1})),d}return typeof O=="function"?(x.current=!0,O(p.current).then(({data:d,hasMore:_,cursor:ue})=>(R===r.current&&(p.current&&(p.current.cursor=ue,p.current.lastItem=d?.[d.length-1]),b.current&&b.current(d,p.current),_&&(I.current=d.length),E.current=_,u(fe=>p.current.page===0?{data:d,isLoading:!1}:{data:(fe.data||[])?.concat(d),isLoading:!1})),d),d=>(E.current=!1,D(d)))):(x.current=!1,O.then(d=>(R===r.current&&(b.current&&b.current(d),u({data:d,isLoading:!1})),d),D))},[b,g,c,i,u,$,k,p,v,w]);$.current=y;let A=(0,l.useCallback)(()=>{p.current={page:0};let U=c.current||[];return y(...U)},[y,c]),T=(0,l.useCallback)(async(U,R)=>{let O;try{if(R?.optimisticUpdate){w(),typeof R?.rollbackOnError!="function"&&R?.rollbackOnError!==!1&&(O=structuredClone(f.current?.value));let D=R.optimisticUpdate;u(d=>({...d,data:D(d.data)}))}return await U}catch(D){if(typeof R?.rollbackOnError=="function"){let d=R.rollbackOnError;u(_=>({..._,data:d(_.data)}))}else R?.optimisticUpdate&&R?.rollbackOnError!==!1&&u(d=>({...d,data:O}));throw D}finally{R?.shouldRevalidateAfter!==!1&&(m.environment.launchType===m.LaunchType.Background||m.environment.commandMode==="menu-bar"?await A():A())}},[A,f,u,w]),C=(0,l.useCallback)(()=>{p.current.page+=1;let U=c.current||[];y(...U)},[p,c,y]);(0,l.useEffect)(()=>{p.current={page:0},t?.execute!==!1?y(...n||[]):w()},[$e([n,t?.execute,y]),o,p]),(0,l.useEffect)(()=>()=>{w()},[w]);let F=t?.execute!==!1?a.isLoading:!1,N={...a,isLoading:F},z=x.current?{pageSize:I.current,hasMore:E.current,onLoadMore:C}:void 0;return{...N,revalidate:A,mutate:T,pagination:z}}function xe(e){return e===Promise.all||e===Promise.race||e===Promise.resolve||e===Promise.reject?e.bind(Promise):e}function ee(e){return typeof e!="function"?!1:/^function\s+\w*\s*\(\s*\)\s*{\s+\[native code\]\s+}$/i.exec(Function.prototype.toString.call(e))!==null}function ve(e){return e instanceof URLSearchParams?e.toString():e}function ae(e,n=[]){function t(r){return"update"in e?e.update(r,"utf8"):e.write(r)}return{dispatch:function(r){r=ve(r),r===null?this._null():this["_"+typeof r](r)},_object:function(r){let a=/\[object (.*)\]/i,u=Object.prototype.toString.call(r),i=a.exec(u)?.[1]??"unknown:["+u+"]";i=i.toLowerCase();let o=null;if((o=n.indexOf(r))>=0){this.dispatch("[CIRCULAR:"+o+"]");return}else n.push(r);if(Buffer.isBuffer(r))return t("buffer:"),t(r.toString("utf8"));if(i!=="object"&&i!=="function"&&i!=="asyncfunction")if(this["_"+i])this["_"+i](r);else throw new Error('Unknown object type "'+i+'"');else{let c=Object.keys(r);c=c.sort(),ee(r)||c.splice(0,0,"prototype","__proto__","constructor"),t("object:"+c.length+":");let g=this;return c.forEach(function(b){g.dispatch(b),t(":"),g.dispatch(r[b]),t(",")})}},_array:function(r,a){a=typeof a<"u"?a:!1;let u=this;if(t("array:"+r.length+":"),!a||r.length<=1){r.forEach(function(c){u.dispatch(c)});return}let i=[],o=r.map(function(c){let g=Se(),b=n.slice();return ae(g,b).dispatch(c),i=i.concat(b.slice(n.length)),g.read().toString()});n=n.concat(i),o.sort(),this._array(o,!1)},_date:function(r){t("date:"+r.toJSON())},_symbol:function(r){t("symbol:"+r.toString())},_error:function(r){t("error:"+r.toString())},_boolean:function(r){t("bool:"+r.toString())},_string:function(r){t("string:"+r.length+":"),t(r.toString())},_function:function(r){t("fn:"),ee(r)?this.dispatch("[native]"):this.dispatch(r.toString()),this.dispatch("function-name:"+String(r.name)),this._object(r)},_number:function(r){t("number:"+r.toString())},_xml:function(r){t("xml:"+r.toString())},_null:function(){t("Null")},_undefined:function(){t("Undefined")},_regexp:function(r){t("regex:"+r.toString())},_uint8array:function(r){t("uint8array:"),this.dispatch(Array.prototype.slice.call(r))},_uint8clampedarray:function(r){t("uint8clampedarray:"),this.dispatch(Array.prototype.slice.call(r))},_int8array:function(r){t("int8array:"),this.dispatch(Array.prototype.slice.call(r))},_uint16array:function(r){t("uint16array:"),this.dispatch(Array.prototype.slice.call(r))},_int16array:function(r){t("int16array:"),this.dispatch(Array.prototype.slice.call(r))},_uint32array:function(r){t("uint32array:"),this.dispatch(Array.prototype.slice.call(r))},_int32array:function(r){t("int32array:"),this.dispatch(Array.prototype.slice.call(r))},_float32array:function(r){t("float32array:"),this.dispatch(Array.prototype.slice.call(r))},_float64array:function(r){t("float64array:"),this.dispatch(Array.prototype.slice.call(r))},_arraybuffer:function(r){t("arraybuffer:"),this.dispatch(new Uint8Array(r))},_url:function(r){t("url:"+r.toString())},_map:function(r){t("map:");let a=Array.from(r);this._array(a,!0)},_set:function(r){t("set:");let a=Array.from(r);this._array(a,!0)},_file:function(r){t("file:"),this.dispatch([r.name,r.size,r.type,r.lastModified])},_blob:function(){throw Error(`Hashing Blob objects is currently not supported
(see https://github.com/puleos/object-hash/issues/26)
Use "options.replacer" or "options.ignoreUnknown"
`)},_domwindow:function(){t("domwindow")},_bigint:function(r){t("bigint:"+r.toString())},_process:function(){t("process")},_timer:function(){t("timer")},_pipe:function(){t("pipe")},_tcp:function(){t("tcp")},_udp:function(){t("udp")},_tty:function(){t("tty")},_statwatcher:function(){t("statwatcher")},_securecontext:function(){t("securecontext")},_connection:function(){t("connection")},_zlib:function(){t("zlib")},_context:function(){t("context")},_nodescript:function(){t("nodescript")},_httpparser:function(){t("httpparser")},_dataview:function(){t("dataview")},_signal:function(){t("signal")},_fsevent:function(){t("fsevent")},_tlswrap:function(){t("tlswrap")}}}function Se(){return{buf:"",write:function(e){this.buf+=e},end:function(e){this.buf+=e},read:function(){return this.buf}}}function Ee(e,n){let t=this[e];return t instanceof Date?`__raycast_cached_date__${t.toISOString()}`:Buffer.isBuffer(t)?`__raycast_cached_buffer__${t.toString("base64")}`:n}function Re(e,n){return typeof n=="string"&&n.startsWith("__raycast_cached_date__")?new Date(n.replace("__raycast_cached_date__","")):typeof n=="string"&&n.startsWith("__raycast_cached_buffer__")?Buffer.from(n.replace("__raycast_cached_buffer__",""),"base64"):n}function K(e){let n=re.default.createHash("sha1");return ae(n).dispatch(e),n.digest("hex")}var Ie=Symbol("cache without namespace"),te=new Map;function Ae(e,n,t){let r=t?.cacheNamespace||Ie,a=te.get(r)||te.set(r,new m.Cache({namespace:t?.cacheNamespace})).get(r);if(!a)throw new Error("Missing cache");let u=S(e),i=S(n),o=(0,l.useSyncExternalStore)(a.subscribe,()=>{try{return a.get(u.current)}catch(k){console.error("Could not get Cache data:",k);return}}),c=(0,l.useMemo)(()=>{if(typeof o<"u"){if(o==="undefined")return;try{return JSON.parse(o,Re)}catch(k){return console.warn("The cached data is corrupted",k),i.current}}else return i.current},[o,i]),g=S(c),b=(0,l.useCallback)(k=>{let v=typeof k=="function"?k(g.current):k;if(typeof v>"u")a.set(u.current,"undefined");else{let f=JSON.stringify(v,Ee);a.set(u.current,f)}return v},[a,u,g]);return[c,b]}var L=Symbol();function Te(e,n,t){let{initialData:r,keepPreviousData:a,internal_cacheKeySuffix:u,...i}=t||{},o=(0,l.useRef)(null),[c,g]=Ae(K(n||[])+u,L,{cacheNamespace:K(e)}),b=(0,l.useRef)(c!==L?c:r),k=(0,l.useRef)(void 0),{mutate:v,revalidate:f,...$}=ke(e,n||[],{...i,onData(w,y){k.current=y,i.onData&&i.onData(w,y),!(y&&y.page>0)&&(o.current="promise",b.current=w,g(w))}}),p,x=$.pagination;k.current&&k.current.page>0&&$.data?p=$.data:o.current==="promise"?p=b.current:a&&c!==L?(p=c,x&&(x.hasMore=!0,x.pageSize=c.length)):a&&c===L?p=b.current:c!==L?(p=c,x&&(x.hasMore=!0,x.pageSize=c.length)):p=r;let E=S(p),I=(0,l.useCallback)(async(w,y)=>{let A;try{if(y?.optimisticUpdate){typeof y?.rollbackOnError!="function"&&y?.rollbackOnError!==!1&&(A=structuredClone(E.current));let T=y.optimisticUpdate(E.current);o.current="cache",b.current=T,g(T)}return await v(w,{shouldRevalidateAfter:y?.shouldRevalidateAfter})}catch(T){if(typeof y?.rollbackOnError=="function"){let C=y.rollbackOnError(E.current);o.current="cache",b.current=C,g(C)}else y?.optimisticUpdate&&y?.rollbackOnError!==!1&&(o.current="cache",b.current=A,g(A));throw T}},[g,v,E,b,o]);return(0,l.useEffect)(()=>{c!==L&&(o.current="cache",b.current=c)},[c]),{data:p,isLoading:$.isLoading,error:$.error,mutate:k.current&&k.current.page>0?v:I,pagination:x,revalidate:f}}function Pe(e){if(e){let n=Ue(e);if(!n)return!1;if(n.subtype==="json"||n.suffix==="json"||n.suffix&&/\bjson\b/i.test(n.suffix)||n.subtype&&/\bjson\b/i.test(n.subtype))return!0}return!1}var Ce=/^([A-Za-z0-9][A-Za-z0-9!#$&^_-]{0,126})\/([A-Za-z0-9][A-Za-z0-9!#$&^_.+-]{0,126});?$/;function Ue(e){let n=e.indexOf(";"),t=n!==-1?e.slice(0,n).trim():e.trim(),r=Ce.exec(t.toLowerCase().toLowerCase());if(!r)return;let a=r[1],u=r[2],i,o=u.lastIndexOf("+");return o!==-1&&(i=u.substring(o+1),u=u.substring(0,o)),{type:a,subtype:u,suffix:i}}async function _e(e){if(!e.ok)throw new Error(e.statusText);let n=e.headers.get("content-type");return n&&Pe(n)?await e.json():await e.text()}function Me(e){return{data:e,hasMore:!1}}function se(e,n){let{parseResponse:t,mapResult:r,initialData:a,execute:u,keepPreviousData:i,onError:o,onData:c,onWillExecute:g,failureToastOptions:b,...k}=n||{},v={initialData:a,execute:u,keepPreviousData:i,onError:o,onData:c,onWillExecute:g,failureToastOptions:b},f=S(t||_e),$=S(r||Me),p=(0,l.useRef)(null),x=(0,l.useRef)(null),E=typeof e=="function"?e({page:0}):void 0;(!p.current||typeof x.current>"u"||x.current!==E)&&(p.current=e),x.current=E;let I=(0,l.useRef)(null),w=(0,l.useCallback)((T,C)=>async F=>{let N=await fetch(T(F),{signal:I.current?.signal,...C}),z=await f.current(N);return $.current?.(z)},[f,$]),y=(0,l.useCallback)(async(T,C)=>{let F=await fetch(T,{signal:I.current?.signal,...C}),N=await f.current(F);return $.current(N)?.data},[f,$]),A=(0,l.useMemo)(()=>x.current?w:y,[x,y,w]);return Te(A,[p.current,k],{...v,internal_cacheKeySuffix:x.current+K($.current)+K(f.current),abortable:I})}var G=require("@raycast/api");function Oe(e,n,t){let r=!!(e?.url&&e?.apiKey)&&t?.execute!==!1,a=e?.url?`${e.url}/api/v3${n}`:"",{data:u,error:i,isLoading:o,mutate:c}=se(a,{headers:{"X-Api-Key":e?.apiKey||"","Content-Type":"application/json"},execute:r,onError:g=>{console.error(`Radarr API Error (${e?.name||"Unknown"}):`,g),(0,G.showToast)({style:G.Toast.Style.Failure,title:"Radarr Error",message:`Failed to connect to ${e?.name||"Radarr"}: ${g.message}`}),t?.onError?.(g)},onData:t?.onData});return{data:u,error:i,isLoading:o,mutate:c}}function ie(e){return Oe(e,"/movie")}function oe(e){let n=e.images?.find(t=>t.coverType==="poster");return n?.remoteUrl||n?.url}var h=require("react/jsx-runtime");function le(){let[e,n]=(0,ce.useState)("all"),{currentInstance:t,isLoading:r,availableInstances:a,switchToInstance:u}=X(),{data:i,isLoading:o,error:c,mutate:g}=ie(t),b=f=>{let $=oe(f),p=f.hasFile,x=p?"\u{1F7E2}":"\u{1F7E1}",E=p?"Available":"Missing",I=`${f.year} \u2022 ${x} ${E}`;return(0,h.jsx)(s.Grid.Item,{content:{source:$||s.Icon.Video,fallback:s.Icon.Video},title:f.title,subtitle:I,actions:(0,h.jsxs)(s.ActionPanel,{children:[(0,h.jsxs)(s.ActionPanel.Section,{children:[(0,h.jsx)(s.Action.OpenInBrowser,{title:"Open in Radarr",url:`${t?.url}/movie/${f.tmdbId}`,icon:s.Icon.Globe}),f.movieFile&&(0,h.jsx)(s.Action.CopyToClipboard,{title:"Copy File Path",content:f.movieFile.path,icon:s.Icon.Clipboard}),f.imdbId&&(0,h.jsx)(s.Action.OpenInBrowser,{title:"Open in Imdb",url:`https://imdb.com/title/${f.imdbId}`,icon:s.Icon.Globe}),f.tmdbId&&(0,h.jsx)(s.Action.OpenInBrowser,{title:"Open in Tmdb",url:`https://themoviedb.org/movie/${f.tmdbId}`,icon:s.Icon.Globe})]}),(0,h.jsx)(s.ActionPanel.Section,{children:(0,h.jsx)(s.Action,{title:"Refresh",icon:s.Icon.RotateClockwise,onAction:g})}),a.length>1&&(0,h.jsxs)(s.ActionPanel.Section,{title:"Instance",children:[a.map(w=>(0,h.jsx)(s.Action,{title:`Switch to ${w.name}`,icon:t?.name===w.name?s.Icon.Check:s.Icon.Circle,onAction:()=>u(w)},w.name)),(0,h.jsx)(s.Action.Open,{title:"Open Preferences",target:"raycast://extensions/preferences",icon:s.Icon.Gear})]})]})},f.id)};if(r)return(0,h.jsx)(s.Grid,{isLoading:!0});if(a.length===0)return(0,h.jsx)(s.Grid,{children:(0,h.jsx)(s.Grid.EmptyView,{title:"No Radarr Instances Configured",description:"Please configure your Radarr instances in preferences",icon:s.Icon.ExclamationMark,actions:(0,h.jsx)(s.ActionPanel,{children:(0,h.jsx)(s.Action.Open,{title:"Open Preferences",target:"raycast://extensions/preferences",icon:s.Icon.Gear})})})});if(c)return(0,h.jsx)(s.Grid,{children:(0,h.jsx)(s.Grid.EmptyView,{title:"Failed to Load Movies",description:`Error: ${c.message}`,icon:s.Icon.ExclamationMark,actions:(0,h.jsx)(s.ActionPanel,{children:(0,h.jsx)(s.Action,{title:"Retry",icon:s.Icon.RotateClockwise,onAction:g})})})});let v=(i?.filter(f=>!f.monitored)||[]).filter(f=>{if(e==="all")return!0;let $=f.hasFile;return e==="available"&&$||e==="missing"&&!$}).sort((f,$)=>f.sortTitle.localeCompare($.sortTitle));return(0,h.jsx)(s.Grid,{isLoading:o,searchBarPlaceholder:`Search unmonitored movies on ${t?.name||"Radarr"}...`,columns:5,fit:s.Grid.Fit.Fill,aspectRatio:"3/4",searchBarAccessory:(0,h.jsxs)(s.Grid.Dropdown,{tooltip:"Filter by Availability",value:e,onChange:f=>n(f),children:[(0,h.jsx)(s.Grid.Dropdown.Item,{title:"All Movies",value:"all"}),(0,h.jsx)(s.Grid.Dropdown.Item,{title:"\u{1F7E2} Available",value:"available"}),(0,h.jsx)(s.Grid.Dropdown.Item,{title:"\u{1F7E1} Missing",value:"missing"})]}),children:v.length===0?(0,h.jsx)(s.Grid.EmptyView,{title:e==="all"?"No Unmonitored Movies":`No ${e.charAt(0).toUpperCase()+e.slice(1)} Unmonitored Movies`,description:e==="all"?"All movies in your library are currently being monitored":`No unmonitored movies match the ${e} filter`,icon:s.Icon.EyeDisabled}):v.map(b)})}
