"use strict";var ue=Object.create;var W=Object.defineProperty;var fe=Object.getOwnPropertyDescriptor;var de=Object.getOwnPropertyNames;var he=Object.getPrototypeOf,pe=Object.prototype.hasOwnProperty;var me=(e,n)=>{for(var r in n)W(e,r,{get:n[r],enumerable:!0})},q=(e,n,r,t)=>{if(n&&typeof n=="object"||typeof n=="function")for(let i of de(n))!pe.call(e,i)&&i!==r&&W(e,i,{get:()=>n[i],enumerable:!(t=fe(n,i))||t.enumerable});return e};var z=(e,n,r)=>(r=e!=null?ue(he(e)):{},q(n||!e||!e.__esModule?W(r,"default",{value:e,enumerable:!0}):r,e)),ge=e=>q(W({},"__esModule",{value:!0}),e);var Oe={};me(Oe,{default:()=>oe});module.exports=ge(Oe);var D=require("react"),a=require("@raycast/api");var H=require("@raycast/api");function J(){let e=(0,H.getPreferenceValues)(),n=[];if(!e.primaryInstanceName||!e.primaryInstanceUrl||!e.primaryInstanceApiKey)throw new Error("Primary Radarr instance configuration is incomplete");return n.push({name:e.primaryInstanceName,url:e.primaryInstanceUrl.replace(/\/$/,""),apiKey:e.primaryInstanceApiKey,isDefault:!0}),e.enableSecondaryInstance&&e.secondaryInstanceName&&e.secondaryInstanceUrl&&e.secondaryInstanceApiKey&&n.push({name:e.secondaryInstanceName,url:e.secondaryInstanceUrl.replace(/\/$/,""),apiKey:e.secondaryInstanceApiKey,isDefault:!1}),n}function X(){let e=(0,H.getPreferenceValues)(),n=J();if(e.activeInstance==="secondary"&&e.enableSecondaryInstance&&n.length>1)return n[1];if(n.length>0)return n[0];throw new Error("No Radarr instances configured")}var c=z(require("react")),g=require("@raycast/api");var Q=Object.prototype.hasOwnProperty;function j(e,n){var r,t;if(e===n)return!0;if(e&&n&&(r=e.constructor)===n.constructor){if(r===Date)return e.getTime()===n.getTime();if(r===RegExp)return e.toString()===n.toString();if(r===Array){if((t=e.length)===n.length)for(;t--&&j(e[t],n[t]););return t===-1}if(!r||typeof e=="object"){t=0;for(r in e)if(Q.call(e,r)&&++t&&!Q.call(n,r)||!(r in n)||!j(e[r],n[r]))return!1;return Object.keys(n).length===t}}return e!==e&&n!==n}var _=z(require("node:fs")),B=z(require("node:path")),re=z(require("node:crypto"));var ne=require("react/jsx-runtime");function be(e){let n=(0,c.useRef)(e),r=(0,c.useRef)(0);return j(e,n.current)||(n.current=e,r.current+=1),(0,c.useMemo)(()=>n.current,[r.current])}function I(e){let n=(0,c.useRef)(e);return n.current=e,n}function ye(e,n){let r=e instanceof Error?e.message:String(e);return(0,g.showToast)({style:g.Toast.Style.Failure,title:n?.title??"Something went wrong",message:n?.message??r,primaryAction:n?.primaryAction??Y(e),secondaryAction:n?.primaryAction?Y(e):void 0})}var Y=e=>{let n=!0,r="[Extension Name]...",t="";try{let o=JSON.parse((0,_.readFileSync)((0,B.join)(g.environment.assetsPath,"..","package.json"),"utf8"));r=`[${o.title}]...`,t=`https://raycast.com/${o.owner||o.author}/${o.name}`,(!o.owner||o.access==="public")&&(n=!1)}catch{}let i=g.environment.isDevelopment||n,u=e instanceof Error?e?.stack||e?.message||"":String(e);return{title:i?"Copy Logs":"Report Error",onAction(o){o.hide(),i?g.Clipboard.copy(u):(0,g.open)(`https://github.com/raycast/extensions/issues/new?&labels=extension%2Cbug&template=extension_bug_report.yml&title=${encodeURIComponent(r)}&extension-url=${encodeURI(t)}&description=${encodeURIComponent(`#### Error:
\`\`\`
${u}
\`\`\`
`)}`)}}};function $e(e,n,r){let t=(0,c.useRef)(0),[i,u]=(0,c.useState)({isLoading:!0}),o=I(e),d=I(r?.abortable),l=I(n||[]),y=I(r?.onError),$=I(r?.onData),s=I(r?.onWillExecute),f=I(r?.failureToastOptions),v=I(i.data),S=(0,c.useRef)(null),h=(0,c.useRef)({page:0}),w=(0,c.useRef)(!1),E=(0,c.useRef)(!0),R=(0,c.useRef)(50),x=(0,c.useCallback)(()=>(d.current&&(d.current.current?.abort(),d.current.current=new AbortController),++t.current),[d]),p=(0,c.useCallback)((...P)=>{let A=x();s.current?.(P),u(m=>({...m,isLoading:!0}));let O=we(o.current)(...P);function M(m){return m.name=="AbortError"||A===t.current&&(y.current?y.current(m):g.environment.launchType!==g.LaunchType.Background&&ye(m,{title:"Failed to fetch latest data",primaryAction:{title:"Retry",onAction(U){U.hide(),S.current?.(...l.current||[])}},...f.current}),u({error:m,isLoading:!1})),m}return typeof O=="function"?(w.current=!0,O(h.current).then(({data:m,hasMore:U,cursor:ce})=>(A===t.current&&(h.current&&(h.current.cursor=ce,h.current.lastItem=m?.[m.length-1]),$.current&&$.current(m,h.current),U&&(R.current=m.length),E.current=U,u(le=>h.current.page===0?{data:m,isLoading:!1}:{data:(le.data||[])?.concat(m),isLoading:!1})),m),m=>(E.current=!1,M(m)))):(w.current=!1,O.then(m=>(A===t.current&&($.current&&$.current(m),u({data:m,isLoading:!1})),m),M))},[$,y,l,o,u,S,s,h,f,x]);S.current=p;let k=(0,c.useCallback)(()=>{h.current={page:0};let P=l.current||[];return p(...P)},[p,l]),C=(0,c.useCallback)(async(P,A)=>{let O;try{if(A?.optimisticUpdate){x(),typeof A?.rollbackOnError!="function"&&A?.rollbackOnError!==!1&&(O=structuredClone(v.current?.value));let M=A.optimisticUpdate;u(m=>({...m,data:M(m.data)}))}return await P}catch(M){if(typeof A?.rollbackOnError=="function"){let m=A.rollbackOnError;u(U=>({...U,data:m(U.data)}))}else A?.optimisticUpdate&&A?.rollbackOnError!==!1&&u(m=>({...m,data:O}));throw M}finally{A?.shouldRevalidateAfter!==!1&&(g.environment.launchType===g.LaunchType.Background||g.environment.commandMode==="menu-bar"?await k():k())}},[k,v,u,x]),T=(0,c.useCallback)(()=>{h.current.page+=1;let P=l.current||[];p(...P)},[h,l,p]);(0,c.useEffect)(()=>{h.current={page:0},r?.execute!==!1?p(...n||[]):x()},[be([n,r?.execute,p]),d,h]),(0,c.useEffect)(()=>()=>{x()},[x]);let F=r?.execute!==!1?i.isLoading:!1,N={...i,isLoading:F},V=w.current?{pageSize:R.current,hasMore:E.current,onLoadMore:T}:void 0;return{...N,revalidate:k,mutate:C,pagination:V}}function we(e){return e===Promise.all||e===Promise.race||e===Promise.resolve||e===Promise.reject?e.bind(Promise):e}function ee(e){return typeof e!="function"?!1:/^function\s+\w*\s*\(\s*\)\s*{\s+\[native code\]\s+}$/i.exec(Function.prototype.toString.call(e))!==null}function ke(e){return e instanceof URLSearchParams?e.toString():e}function ae(e,n=[]){function r(t){return"update"in e?e.update(t,"utf8"):e.write(t)}return{dispatch:function(t){t=ke(t),t===null?this._null():this["_"+typeof t](t)},_object:function(t){let i=/\[object (.*)\]/i,u=Object.prototype.toString.call(t),o=i.exec(u)?.[1]??"unknown:["+u+"]";o=o.toLowerCase();let d=null;if((d=n.indexOf(t))>=0){this.dispatch("[CIRCULAR:"+d+"]");return}else n.push(t);if(Buffer.isBuffer(t))return r("buffer:"),r(t.toString("utf8"));if(o!=="object"&&o!=="function"&&o!=="asyncfunction")if(this["_"+o])this["_"+o](t);else throw new Error('Unknown object type "'+o+'"');else{let l=Object.keys(t);l=l.sort(),ee(t)||l.splice(0,0,"prototype","__proto__","constructor"),r("object:"+l.length+":");let y=this;return l.forEach(function($){y.dispatch($),r(":"),y.dispatch(t[$]),r(",")})}},_array:function(t,i){i=typeof i<"u"?i:!1;let u=this;if(r("array:"+t.length+":"),!i||t.length<=1){t.forEach(function(l){u.dispatch(l)});return}let o=[],d=t.map(function(l){let y=xe(),$=n.slice();return ae(y,$).dispatch(l),o=o.concat($.slice(n.length)),y.read().toString()});n=n.concat(o),d.sort(),this._array(d,!1)},_date:function(t){r("date:"+t.toJSON())},_symbol:function(t){r("symbol:"+t.toString())},_error:function(t){r("error:"+t.toString())},_boolean:function(t){r("bool:"+t.toString())},_string:function(t){r("string:"+t.length+":"),r(t.toString())},_function:function(t){r("fn:"),ee(t)?this.dispatch("[native]"):this.dispatch(t.toString()),this.dispatch("function-name:"+String(t.name)),this._object(t)},_number:function(t){r("number:"+t.toString())},_xml:function(t){r("xml:"+t.toString())},_null:function(){r("Null")},_undefined:function(){r("Undefined")},_regexp:function(t){r("regex:"+t.toString())},_uint8array:function(t){r("uint8array:"),this.dispatch(Array.prototype.slice.call(t))},_uint8clampedarray:function(t){r("uint8clampedarray:"),this.dispatch(Array.prototype.slice.call(t))},_int8array:function(t){r("int8array:"),this.dispatch(Array.prototype.slice.call(t))},_uint16array:function(t){r("uint16array:"),this.dispatch(Array.prototype.slice.call(t))},_int16array:function(t){r("int16array:"),this.dispatch(Array.prototype.slice.call(t))},_uint32array:function(t){r("uint32array:"),this.dispatch(Array.prototype.slice.call(t))},_int32array:function(t){r("int32array:"),this.dispatch(Array.prototype.slice.call(t))},_float32array:function(t){r("float32array:"),this.dispatch(Array.prototype.slice.call(t))},_float64array:function(t){r("float64array:"),this.dispatch(Array.prototype.slice.call(t))},_arraybuffer:function(t){r("arraybuffer:"),this.dispatch(new Uint8Array(t))},_url:function(t){r("url:"+t.toString())},_map:function(t){r("map:");let i=Array.from(t);this._array(i,!0)},_set:function(t){r("set:");let i=Array.from(t);this._array(i,!0)},_file:function(t){r("file:"),this.dispatch([t.name,t.size,t.type,t.lastModified])},_blob:function(){throw Error(`Hashing Blob objects is currently not supported
(see https://github.com/puleos/object-hash/issues/26)
Use "options.replacer" or "options.ignoreUnknown"
`)},_domwindow:function(){r("domwindow")},_bigint:function(t){r("bigint:"+t.toString())},_process:function(){r("process")},_timer:function(){r("timer")},_pipe:function(){r("pipe")},_tcp:function(){r("tcp")},_udp:function(){r("udp")},_tty:function(){r("tty")},_statwatcher:function(){r("statwatcher")},_securecontext:function(){r("securecontext")},_connection:function(){r("connection")},_zlib:function(){r("zlib")},_context:function(){r("context")},_nodescript:function(){r("nodescript")},_httpparser:function(){r("httpparser")},_dataview:function(){r("dataview")},_signal:function(){r("signal")},_fsevent:function(){r("fsevent")},_tlswrap:function(){r("tlswrap")}}}function xe(){return{buf:"",write:function(e){this.buf+=e},end:function(e){this.buf+=e},read:function(){return this.buf}}}function ve(e,n){let r=this[e];return r instanceof Date?`__raycast_cached_date__${r.toISOString()}`:Buffer.isBuffer(r)?`__raycast_cached_buffer__${r.toString("base64")}`:n}function Se(e,n){return typeof n=="string"&&n.startsWith("__raycast_cached_date__")?new Date(n.replace("__raycast_cached_date__","")):typeof n=="string"&&n.startsWith("__raycast_cached_buffer__")?Buffer.from(n.replace("__raycast_cached_buffer__",""),"base64"):n}function K(e){let n=re.default.createHash("sha1");return ae(n).dispatch(e),n.digest("hex")}var Ee=Symbol("cache without namespace"),te=new Map;function Ie(e,n,r){let t=r?.cacheNamespace||Ee,i=te.get(t)||te.set(t,new g.Cache({namespace:r?.cacheNamespace})).get(t);if(!i)throw new Error("Missing cache");let u=I(e),o=I(n),d=(0,c.useSyncExternalStore)(i.subscribe,()=>{try{return i.get(u.current)}catch(s){console.error("Could not get Cache data:",s);return}}),l=(0,c.useMemo)(()=>{if(typeof d<"u"){if(d==="undefined")return;try{return JSON.parse(d,Se)}catch(s){return console.warn("The cached data is corrupted",s),o.current}}else return o.current},[d,o]),y=I(l),$=(0,c.useCallback)(s=>{let f=typeof s=="function"?s(y.current):s;if(typeof f>"u")i.set(u.current,"undefined");else{let v=JSON.stringify(f,ve);i.set(u.current,v)}return f},[i,u,y]);return[l,$]}var L=Symbol();function Re(e,n,r){let{initialData:t,keepPreviousData:i,internal_cacheKeySuffix:u,...o}=r||{},d=(0,c.useRef)(null),[l,y]=Ie(K(n||[])+u,L,{cacheNamespace:K(e)}),$=(0,c.useRef)(l!==L?l:t),s=(0,c.useRef)(void 0),{mutate:f,revalidate:v,...S}=$e(e,n||[],{...o,onData(x,p){s.current=p,o.onData&&o.onData(x,p),!(p&&p.page>0)&&(d.current="promise",$.current=x,y(x))}}),h,w=S.pagination;s.current&&s.current.page>0&&S.data?h=S.data:d.current==="promise"?h=$.current:i&&l!==L?(h=l,w&&(w.hasMore=!0,w.pageSize=l.length)):i&&l===L?h=$.current:l!==L?(h=l,w&&(w.hasMore=!0,w.pageSize=l.length)):h=t;let E=I(h),R=(0,c.useCallback)(async(x,p)=>{let k;try{if(p?.optimisticUpdate){typeof p?.rollbackOnError!="function"&&p?.rollbackOnError!==!1&&(k=structuredClone(E.current));let C=p.optimisticUpdate(E.current);d.current="cache",$.current=C,y(C)}return await f(x,{shouldRevalidateAfter:p?.shouldRevalidateAfter})}catch(C){if(typeof p?.rollbackOnError=="function"){let T=p.rollbackOnError(E.current);d.current="cache",$.current=T,y(T)}else p?.optimisticUpdate&&p?.rollbackOnError!==!1&&(d.current="cache",$.current=k,y(k));throw C}},[y,f,E,$,d]);return(0,c.useEffect)(()=>{l!==L&&(d.current="cache",$.current=l)},[l]),{data:h,isLoading:S.isLoading,error:S.error,mutate:s.current&&s.current.page>0?f:R,pagination:w,revalidate:v}}function Ae(e){if(e){let n=Te(e);if(!n)return!1;if(n.subtype==="json"||n.suffix==="json"||n.suffix&&/\bjson\b/i.test(n.suffix)||n.subtype&&/\bjson\b/i.test(n.subtype))return!0}return!1}var Ce=/^([A-Za-z0-9][A-Za-z0-9!#$&^_-]{0,126})\/([A-Za-z0-9][A-Za-z0-9!#$&^_.+-]{0,126});?$/;function Te(e){let n=e.indexOf(";"),r=n!==-1?e.slice(0,n).trim():e.trim(),t=Ce.exec(r.toLowerCase().toLowerCase());if(!t)return;let i=t[1],u=t[2],o,d=u.lastIndexOf("+");return d!==-1&&(o=u.substring(d+1),u=u.substring(0,d)),{type:i,subtype:u,suffix:o}}async function Pe(e){if(!e.ok)throw new Error(e.statusText);let n=e.headers.get("content-type");return n&&Ae(n)?await e.json():await e.text()}function Ue(e){return{data:e,hasMore:!1}}function se(e,n){let{parseResponse:r,mapResult:t,initialData:i,execute:u,keepPreviousData:o,onError:d,onData:l,onWillExecute:y,failureToastOptions:$,...s}=n||{},f={initialData:i,execute:u,keepPreviousData:o,onError:d,onData:l,onWillExecute:y,failureToastOptions:$},v=I(r||Pe),S=I(t||Ue),h=(0,c.useRef)(null),w=(0,c.useRef)(null),E=typeof e=="function"?e({page:0}):void 0;(!h.current||typeof w.current>"u"||w.current!==E)&&(h.current=e),w.current=E;let R=(0,c.useRef)(null),x=(0,c.useCallback)((C,T)=>async F=>{let N=await fetch(C(F),{signal:R.current?.signal,...T}),V=await v.current(N);return S.current?.(V)},[v,S]),p=(0,c.useCallback)(async(C,T)=>{let F=await fetch(C,{signal:R.current?.signal,...T}),N=await v.current(F);return S.current(N)?.data},[v,S]),k=(0,c.useMemo)(()=>w.current?x:p,[w,p,x]);return Re(k,[h.current,s],{...f,internal_cacheKeySuffix:w.current+K(S.current)+K(v.current),abortable:R})}var G=require("@raycast/api");function _e(e,n,r){let t=!!(e?.url&&e?.apiKey)&&r?.execute!==!1,i=e?.url?`${e.url}/api/v3${n}`:"",{data:u,error:o,isLoading:d,mutate:l}=se(i,{headers:{"X-Api-Key":e?.apiKey||"","Content-Type":"application/json"},execute:t,onError:y=>{console.error(`Radarr API Error (${e?.name||"Unknown"}):`,y),(0,G.showToast)({style:G.Toast.Style.Failure,title:"Radarr Error",message:`Failed to connect to ${e?.name||"Radarr"}: ${y.message}`}),r?.onError?.(y)},onData:r?.onData});return{data:u,error:o,isLoading:d,mutate:l}}function ie(e){return _e(e,"/health")}async function Z(e){if(!e?.url||!e?.apiKey)return!1;try{let n=`${e.url}/api/v3/system/status`;return(await fetch(n,{headers:{"X-Api-Key":e.apiKey,"Content-Type":"application/json"}})).ok}catch(n){return console.error("Connection test failed:",n),!1}}var b=require("react/jsx-runtime");function oe(){let[e,n]=(0,D.useState)([]),[r,t]=(0,D.useState)({}),[i,u]=(0,D.useState)(!0),o=(()=>{try{return X()}catch(s){return console.error("Failed to get active instance:",s),null}})();(0,D.useEffect)(()=>{(async()=>{try{let f=J();n(f);let v=await Promise.all(f.map(async h=>{let w=await Z(h);return{name:h.name,isConnected:w}})),S={};v.forEach(h=>{S[h.name]=h.isConnected}),t(S),u(!1)}catch(f){console.error("Failed to load instances:",f),(0,a.showToast)({style:a.Toast.Style.Failure,title:"Configuration Error",message:f instanceof Error?f.message:"Failed to load Radarr configuration"}),u(!1)}})()},[]);let d=async s=>{t(f=>({...f,[s.name]:void 0}));try{let f=await Z(s);t(v=>({...v,[s.name]:f})),(0,a.showToast)({style:f?a.Toast.Style.Success:a.Toast.Style.Failure,title:f?"Connection Successful":"Connection Failed",message:`${s.name}: ${f?"API accessible":"Cannot connect to API"}`})}catch(f){console.error("Connection test failed:",f),t(v=>({...v,[s.name]:!1})),(0,a.showToast)({style:a.Toast.Style.Failure,title:"Connection Error",message:`Failed to test connection to ${s.name}`})}},l=s=>{let f=r[s];return f===void 0?{source:a.Icon.Clock,tintColor:a.Color.Orange}:f===!0?{source:a.Icon.CheckCircle,tintColor:a.Color.Green}:{source:a.Icon.XMarkCircle,tintColor:a.Color.Red}},y=s=>{let f=r[s];return f===void 0?"Testing...":f===!0?"Connected":"Failed"},$=({instance:s})=>{let f=l(s.name),v=y(s.name),S=o?.name===s.name,h=r[s.name]===!0,{data:w}=ie(h?s:null),E=w?.filter(k=>k.type==="error")||[],R=w?.filter(k=>k.type==="warning")||[],x=E.length>0||R.length>0,p=(0,b.jsxs)(a.ActionPanel.Section,{title:"Quick Actions",children:[(0,b.jsx)(a.Action.OpenInBrowser,{title:"View Movie Library",url:`${s.url}/movie`,icon:a.Icon.Video}),(0,b.jsx)(a.Action.OpenInBrowser,{title:"View Queue",url:`${s.url}/activity/queue`,icon:a.Icon.Download}),(0,b.jsx)(a.Action.OpenInBrowser,{title:"View Calendar",url:`${s.url}/calendar`,icon:a.Icon.Calendar})]});return(0,b.jsxs)(a.List.Section,{title:s.name,children:[(0,b.jsx)(a.List.Item,{icon:f,title:s.name,subtitle:s.url,accessories:[{text:v},...S?[{tag:{value:"Selected",color:a.Color.Green}}]:[]],actions:(0,b.jsxs)(a.ActionPanel,{children:[(0,b.jsxs)(a.ActionPanel.Section,{children:[(0,b.jsx)(a.Action,{title:"Test Connection",icon:a.Icon.Network,onAction:()=>d(s)}),(0,b.jsx)(a.Action.OpenInBrowser,{title:"Open in Browser",url:s.url,icon:a.Icon.Globe})]}),p,(0,b.jsx)(a.ActionPanel.Section,{children:(0,b.jsx)(a.Action.Open,{title:"Open Extension Preferences",target:"raycast://extensions/preferences",icon:a.Icon.Gear})})]})}),h&&w&&(0,b.jsx)(a.List.Item,{title:"Health Status",subtitle:x?`${E.length} error${E.length!==1?"s":""}, ${R.length} warning${R.length!==1?"s":""}`:"All systems operational",icon:x?a.Icon.ExclamationMark:a.Icon.CheckCircle,accessories:[{tag:{value:x?"Issues Found":"Healthy",color:x?E.length>0?a.Color.Red:a.Color.Orange:a.Color.Green}}],actions:(0,b.jsxs)(a.ActionPanel,{children:[(0,b.jsx)(a.Action.OpenInBrowser,{title:"Open System Status",url:`${s.url}/system/status`,icon:a.Icon.Globe}),p]})}),E.map(k=>(0,b.jsx)(a.List.Item,{title:k.message,subtitle:k.source,icon:{source:a.Icon.XMarkCircle,tintColor:a.Color.Red},accessories:[{tag:{value:"Error",color:a.Color.Red}}],actions:(0,b.jsxs)(a.ActionPanel,{children:[(0,b.jsx)(a.Action.OpenInBrowser,{title:"Open System Status",url:`${s.url}/system/status`,icon:a.Icon.Globe}),p]})},k.source)),R.map(k=>(0,b.jsx)(a.List.Item,{title:k.message,subtitle:k.source,icon:{source:a.Icon.Warning,tintColor:a.Color.Orange},accessories:[{tag:{value:"Warning",color:a.Color.Orange}}],actions:(0,b.jsxs)(a.ActionPanel,{children:[(0,b.jsx)(a.Action.OpenInBrowser,{title:"Open System Status",url:`${s.url}/system/status`,icon:a.Icon.Globe}),p]})},k.source))]},s.name)};return(0,b.jsx)(a.List,{isLoading:i,searchBarPlaceholder:"Search Radarr instances...",children:e.length===0?(0,b.jsx)(a.List.EmptyView,{title:"No Radarr Instances Configured",description:"Configure your Radarr instances in extension preferences",icon:a.Icon.ExclamationMark,actions:(0,b.jsx)(a.ActionPanel,{children:(0,b.jsx)(a.Action.Open,{title:"Open Extension Preferences",target:"raycast://extensions/preferences",icon:a.Icon.Gear})})}):e.map(s=>(0,b.jsx)($,{instance:s},s.name))})}
