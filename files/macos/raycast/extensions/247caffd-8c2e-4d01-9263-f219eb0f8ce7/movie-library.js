"use strict";var de=Object.create;var z=Object.defineProperty;var he=Object.getOwnPropertyDescriptor;var pe=Object.getOwnPropertyNames;var me=Object.getPrototypeOf,ge=Object.prototype.hasOwnProperty;var be=(e,n)=>{for(var t in n)z(e,t,{get:n[t],enumerable:!0})},Z=(e,n,t,r)=>{if(n&&typeof n=="object"||typeof n=="function")for(let a of pe(n))!ge.call(e,a)&&a!==t&&z(e,a,{get:()=>n[a],enumerable:!(r=he(n,a))||r.enumerable});return e};var W=(e,n,t)=>(t=e!=null?de(me(e)):{},Z(n||!e||!e.__esModule?z(t,"default",{value:e,enumerable:!0}):t,e)),ye=e=>Z(z({},"__esModule",{value:!0}),e);var De={};be(De,{default:()=>le});module.exports=ye(De);var ce=require("react"),s=require("@raycast/api");var P=require("react");var H=require("@raycast/api");function J(){let e=(0,H.getPreferenceValues)(),n=[];if(!e.primaryInstanceName||!e.primaryInstanceUrl||!e.primaryInstanceApiKey)throw new Error("Primary Radarr instance configuration is incomplete");return n.push({name:e.primaryInstanceName,url:e.primaryInstanceUrl.replace(/\/$/,""),apiKey:e.primaryInstanceApiKey,isDefault:!0}),e.enableSecondaryInstance&&e.secondaryInstanceName&&e.secondaryInstanceUrl&&e.secondaryInstanceApiKey&&n.push({name:e.secondaryInstanceName,url:e.secondaryInstanceUrl.replace(/\/$/,""),apiKey:e.secondaryInstanceApiKey,isDefault:!1}),n}function q(){let e=(0,H.getPreferenceValues)(),n=J();if(e.activeInstance==="secondary"&&e.enableSecondaryInstance&&n.length>1)return n[1];if(n.length>0)return n[0];throw new Error("No Radarr instances configured")}function X(){let[e,n]=(0,P.useState)(null),[t,r]=(0,P.useState)(!0),a=(0,P.useCallback)(()=>{try{let o=q();n(o)}catch(o){console.error("Failed to load default instance:",o),n(null)}finally{r(!1)}},[]);(0,P.useEffect)(()=>{a()},[a]);let u=(0,P.useCallback)(o=>{n(o)},[]),i=(0,P.useMemo)(()=>{try{return J()}catch{return[]}},[]);return{currentInstance:e,isLoading:t,availableInstances:i,switchToInstance:u}}var l=W(require("react")),p=require("@raycast/api");var Y=Object.prototype.hasOwnProperty;function j(e,n){var t,r;if(e===n)return!0;if(e&&n&&(t=e.constructor)===n.constructor){if(t===Date)return e.getTime()===n.getTime();if(t===RegExp)return e.toString()===n.toString();if(t===Array){if((r=e.length)===n.length)for(;r--&&j(e[r],n[r]););return r===-1}if(!t||typeof e=="object"){r=0;for(t in e)if(Y.call(e,t)&&++r&&!Y.call(n,t)||!(t in n)||!j(e[t],n[t]))return!1;return Object.keys(n).length===r}}return e!==e&&n!==n}var M=W(require("node:fs")),B=W(require("node:path")),re=W(require("node:crypto"));var ne=require("react/jsx-runtime");function $e(e){let n=(0,l.useRef)(e),t=(0,l.useRef)(0);return j(e,n.current)||(n.current=e,t.current+=1),(0,l.useMemo)(()=>n.current,[t.current])}function S(e){let n=(0,l.useRef)(e);return n.current=e,n}function we(e,n){let t=e instanceof Error?e.message:String(e);return(0,p.showToast)({style:p.Toast.Style.Failure,title:n?.title??"Something went wrong",message:n?.message??t,primaryAction:n?.primaryAction??Q(e),secondaryAction:n?.primaryAction?Q(e):void 0})}var Q=e=>{let n=!0,t="[Extension Name]...",r="";try{let i=JSON.parse((0,M.readFileSync)((0,B.join)(p.environment.assetsPath,"..","package.json"),"utf8"));t=`[${i.title}]...`,r=`https://raycast.com/${i.owner||i.author}/${i.name}`,(!i.owner||i.access==="public")&&(n=!1)}catch{}let a=p.environment.isDevelopment||n,u=e instanceof Error?e?.stack||e?.message||"":String(e);return{title:a?"Copy Logs":"Report Error",onAction(i){i.hide(),a?p.Clipboard.copy(u):(0,p.open)(`https://github.com/raycast/extensions/issues/new?&labels=extension%2Cbug&template=extension_bug_report.yml&title=${encodeURIComponent(t)}&extension-url=${encodeURI(r)}&description=${encodeURIComponent(`#### Error:
\`\`\`
${u}
\`\`\`
`)}`)}}};function ke(e,n,t){let r=(0,l.useRef)(0),[a,u]=(0,l.useState)({isLoading:!0}),i=S(e),o=S(t?.abortable),c=S(n||[]),m=S(t?.onError),b=S(t?.onData),$=S(t?.onWillExecute),f=S(t?.failureToastOptions),x=S(a.data),k=(0,l.useRef)(null),g=(0,l.useRef)({page:0}),w=(0,l.useRef)(!1),E=(0,l.useRef)(!0),R=(0,l.useRef)(50),v=(0,l.useCallback)(()=>(o.current&&(o.current.current?.abort(),o.current.current=new AbortController),++r.current),[o]),y=(0,l.useCallback)((...U)=>{let I=v();$.current?.(U),u(d=>({...d,isLoading:!0}));let O=xe(i.current)(...U);function D(d){return d.name=="AbortError"||I===r.current&&(m.current?m.current(d):p.environment.launchType!==p.LaunchType.Background&&we(d,{title:"Failed to fetch latest data",primaryAction:{title:"Retry",onAction(_){_.hide(),k.current?.(...c.current||[])}},...f.current}),u({error:d,isLoading:!1})),d}return typeof O=="function"?(w.current=!0,O(g.current).then(({data:d,hasMore:_,cursor:ue})=>(I===r.current&&(g.current&&(g.current.cursor=ue,g.current.lastItem=d?.[d.length-1]),b.current&&b.current(d,g.current),_&&(R.current=d.length),E.current=_,u(fe=>g.current.page===0?{data:d,isLoading:!1}:{data:(fe.data||[])?.concat(d),isLoading:!1})),d),d=>(E.current=!1,D(d)))):(w.current=!1,O.then(d=>(I===r.current&&(b.current&&b.current(d),u({data:d,isLoading:!1})),d),D))},[b,m,c,i,u,k,$,g,f,v]);k.current=y;let A=(0,l.useCallback)(()=>{g.current={page:0};let U=c.current||[];return y(...U)},[y,c]),T=(0,l.useCallback)(async(U,I)=>{let O;try{if(I?.optimisticUpdate){v(),typeof I?.rollbackOnError!="function"&&I?.rollbackOnError!==!1&&(O=structuredClone(x.current?.value));let D=I.optimisticUpdate;u(d=>({...d,data:D(d.data)}))}return await U}catch(D){if(typeof I?.rollbackOnError=="function"){let d=I.rollbackOnError;u(_=>({..._,data:d(_.data)}))}else I?.optimisticUpdate&&I?.rollbackOnError!==!1&&u(d=>({...d,data:O}));throw D}finally{I?.shouldRevalidateAfter!==!1&&(p.environment.launchType===p.LaunchType.Background||p.environment.commandMode==="menu-bar"?await A():A())}},[A,x,u,v]),C=(0,l.useCallback)(()=>{g.current.page+=1;let U=c.current||[];y(...U)},[g,c,y]);(0,l.useEffect)(()=>{g.current={page:0},t?.execute!==!1?y(...n||[]):v()},[$e([n,t?.execute,y]),o,g]),(0,l.useEffect)(()=>()=>{v()},[v]);let F=t?.execute!==!1?a.isLoading:!1,N={...a,isLoading:F},V=w.current?{pageSize:R.current,hasMore:E.current,onLoadMore:C}:void 0;return{...N,revalidate:A,mutate:T,pagination:V}}function xe(e){return e===Promise.all||e===Promise.race||e===Promise.resolve||e===Promise.reject?e.bind(Promise):e}function ee(e){return typeof e!="function"?!1:/^function\s+\w*\s*\(\s*\)\s*{\s+\[native code\]\s+}$/i.exec(Function.prototype.toString.call(e))!==null}function ve(e){return e instanceof URLSearchParams?e.toString():e}function ae(e,n=[]){function t(r){return"update"in e?e.update(r,"utf8"):e.write(r)}return{dispatch:function(r){r=ve(r),r===null?this._null():this["_"+typeof r](r)},_object:function(r){let a=/\[object (.*)\]/i,u=Object.prototype.toString.call(r),i=a.exec(u)?.[1]??"unknown:["+u+"]";i=i.toLowerCase();let o=null;if((o=n.indexOf(r))>=0){this.dispatch("[CIRCULAR:"+o+"]");return}else n.push(r);if(Buffer.isBuffer(r))return t("buffer:"),t(r.toString("utf8"));if(i!=="object"&&i!=="function"&&i!=="asyncfunction")if(this["_"+i])this["_"+i](r);else throw new Error('Unknown object type "'+i+'"');else{let c=Object.keys(r);c=c.sort(),ee(r)||c.splice(0,0,"prototype","__proto__","constructor"),t("object:"+c.length+":");let m=this;return c.forEach(function(b){m.dispatch(b),t(":"),m.dispatch(r[b]),t(",")})}},_array:function(r,a){a=typeof a<"u"?a:!1;let u=this;if(t("array:"+r.length+":"),!a||r.length<=1){r.forEach(function(c){u.dispatch(c)});return}let i=[],o=r.map(function(c){let m=Se(),b=n.slice();return ae(m,b).dispatch(c),i=i.concat(b.slice(n.length)),m.read().toString()});n=n.concat(i),o.sort(),this._array(o,!1)},_date:function(r){t("date:"+r.toJSON())},_symbol:function(r){t("symbol:"+r.toString())},_error:function(r){t("error:"+r.toString())},_boolean:function(r){t("bool:"+r.toString())},_string:function(r){t("string:"+r.length+":"),t(r.toString())},_function:function(r){t("fn:"),ee(r)?this.dispatch("[native]"):this.dispatch(r.toString()),this.dispatch("function-name:"+String(r.name)),this._object(r)},_number:function(r){t("number:"+r.toString())},_xml:function(r){t("xml:"+r.toString())},_null:function(){t("Null")},_undefined:function(){t("Undefined")},_regexp:function(r){t("regex:"+r.toString())},_uint8array:function(r){t("uint8array:"),this.dispatch(Array.prototype.slice.call(r))},_uint8clampedarray:function(r){t("uint8clampedarray:"),this.dispatch(Array.prototype.slice.call(r))},_int8array:function(r){t("int8array:"),this.dispatch(Array.prototype.slice.call(r))},_uint16array:function(r){t("uint16array:"),this.dispatch(Array.prototype.slice.call(r))},_int16array:function(r){t("int16array:"),this.dispatch(Array.prototype.slice.call(r))},_uint32array:function(r){t("uint32array:"),this.dispatch(Array.prototype.slice.call(r))},_int32array:function(r){t("int32array:"),this.dispatch(Array.prototype.slice.call(r))},_float32array:function(r){t("float32array:"),this.dispatch(Array.prototype.slice.call(r))},_float64array:function(r){t("float64array:"),this.dispatch(Array.prototype.slice.call(r))},_arraybuffer:function(r){t("arraybuffer:"),this.dispatch(new Uint8Array(r))},_url:function(r){t("url:"+r.toString())},_map:function(r){t("map:");let a=Array.from(r);this._array(a,!0)},_set:function(r){t("set:");let a=Array.from(r);this._array(a,!0)},_file:function(r){t("file:"),this.dispatch([r.name,r.size,r.type,r.lastModified])},_blob:function(){throw Error(`Hashing Blob objects is currently not supported
(see https://github.com/puleos/object-hash/issues/26)
Use "options.replacer" or "options.ignoreUnknown"
`)},_domwindow:function(){t("domwindow")},_bigint:function(r){t("bigint:"+r.toString())},_process:function(){t("process")},_timer:function(){t("timer")},_pipe:function(){t("pipe")},_tcp:function(){t("tcp")},_udp:function(){t("udp")},_tty:function(){t("tty")},_statwatcher:function(){t("statwatcher")},_securecontext:function(){t("securecontext")},_connection:function(){t("connection")},_zlib:function(){t("zlib")},_context:function(){t("context")},_nodescript:function(){t("nodescript")},_httpparser:function(){t("httpparser")},_dataview:function(){t("dataview")},_signal:function(){t("signal")},_fsevent:function(){t("fsevent")},_tlswrap:function(){t("tlswrap")}}}function Se(){return{buf:"",write:function(e){this.buf+=e},end:function(e){this.buf+=e},read:function(){return this.buf}}}function Ee(e,n){let t=this[e];return t instanceof Date?`__raycast_cached_date__${t.toISOString()}`:Buffer.isBuffer(t)?`__raycast_cached_buffer__${t.toString("base64")}`:n}function Re(e,n){return typeof n=="string"&&n.startsWith("__raycast_cached_date__")?new Date(n.replace("__raycast_cached_date__","")):typeof n=="string"&&n.startsWith("__raycast_cached_buffer__")?Buffer.from(n.replace("__raycast_cached_buffer__",""),"base64"):n}function K(e){let n=re.default.createHash("sha1");return ae(n).dispatch(e),n.digest("hex")}var Ie=Symbol("cache without namespace"),te=new Map;function Ae(e,n,t){let r=t?.cacheNamespace||Ie,a=te.get(r)||te.set(r,new p.Cache({namespace:t?.cacheNamespace})).get(r);if(!a)throw new Error("Missing cache");let u=S(e),i=S(n),o=(0,l.useSyncExternalStore)(a.subscribe,()=>{try{return a.get(u.current)}catch($){console.error("Could not get Cache data:",$);return}}),c=(0,l.useMemo)(()=>{if(typeof o<"u"){if(o==="undefined")return;try{return JSON.parse(o,Re)}catch($){return console.warn("The cached data is corrupted",$),i.current}}else return i.current},[o,i]),m=S(c),b=(0,l.useCallback)($=>{let f=typeof $=="function"?$(m.current):$;if(typeof f>"u")a.set(u.current,"undefined");else{let x=JSON.stringify(f,Ee);a.set(u.current,x)}return f},[a,u,m]);return[c,b]}var L=Symbol();function Te(e,n,t){let{initialData:r,keepPreviousData:a,internal_cacheKeySuffix:u,...i}=t||{},o=(0,l.useRef)(null),[c,m]=Ae(K(n||[])+u,L,{cacheNamespace:K(e)}),b=(0,l.useRef)(c!==L?c:r),$=(0,l.useRef)(void 0),{mutate:f,revalidate:x,...k}=ke(e,n||[],{...i,onData(v,y){$.current=y,i.onData&&i.onData(v,y),!(y&&y.page>0)&&(o.current="promise",b.current=v,m(v))}}),g,w=k.pagination;$.current&&$.current.page>0&&k.data?g=k.data:o.current==="promise"?g=b.current:a&&c!==L?(g=c,w&&(w.hasMore=!0,w.pageSize=c.length)):a&&c===L?g=b.current:c!==L?(g=c,w&&(w.hasMore=!0,w.pageSize=c.length)):g=r;let E=S(g),R=(0,l.useCallback)(async(v,y)=>{let A;try{if(y?.optimisticUpdate){typeof y?.rollbackOnError!="function"&&y?.rollbackOnError!==!1&&(A=structuredClone(E.current));let T=y.optimisticUpdate(E.current);o.current="cache",b.current=T,m(T)}return await f(v,{shouldRevalidateAfter:y?.shouldRevalidateAfter})}catch(T){if(typeof y?.rollbackOnError=="function"){let C=y.rollbackOnError(E.current);o.current="cache",b.current=C,m(C)}else y?.optimisticUpdate&&y?.rollbackOnError!==!1&&(o.current="cache",b.current=A,m(A));throw T}},[m,f,E,b,o]);return(0,l.useEffect)(()=>{c!==L&&(o.current="cache",b.current=c)},[c]),{data:g,isLoading:k.isLoading,error:k.error,mutate:$.current&&$.current.page>0?f:R,pagination:w,revalidate:x}}function Pe(e){if(e){let n=Ue(e);if(!n)return!1;if(n.subtype==="json"||n.suffix==="json"||n.suffix&&/\bjson\b/i.test(n.suffix)||n.subtype&&/\bjson\b/i.test(n.subtype))return!0}return!1}var Ce=/^([A-Za-z0-9][A-Za-z0-9!#$&^_-]{0,126})\/([A-Za-z0-9][A-Za-z0-9!#$&^_.+-]{0,126});?$/;function Ue(e){let n=e.indexOf(";"),t=n!==-1?e.slice(0,n).trim():e.trim(),r=Ce.exec(t.toLowerCase().toLowerCase());if(!r)return;let a=r[1],u=r[2],i,o=u.lastIndexOf("+");return o!==-1&&(i=u.substring(o+1),u=u.substring(0,o)),{type:a,subtype:u,suffix:i}}async function _e(e){if(!e.ok)throw new Error(e.statusText);let n=e.headers.get("content-type");return n&&Pe(n)?await e.json():await e.text()}function Me(e){return{data:e,hasMore:!1}}function se(e,n){let{parseResponse:t,mapResult:r,initialData:a,execute:u,keepPreviousData:i,onError:o,onData:c,onWillExecute:m,failureToastOptions:b,...$}=n||{},f={initialData:a,execute:u,keepPreviousData:i,onError:o,onData:c,onWillExecute:m,failureToastOptions:b},x=S(t||_e),k=S(r||Me),g=(0,l.useRef)(null),w=(0,l.useRef)(null),E=typeof e=="function"?e({page:0}):void 0;(!g.current||typeof w.current>"u"||w.current!==E)&&(g.current=e),w.current=E;let R=(0,l.useRef)(null),v=(0,l.useCallback)((T,C)=>async F=>{let N=await fetch(T(F),{signal:R.current?.signal,...C}),V=await x.current(N);return k.current?.(V)},[x,k]),y=(0,l.useCallback)(async(T,C)=>{let F=await fetch(T,{signal:R.current?.signal,...C}),N=await x.current(F);return k.current(N)?.data},[x,k]),A=(0,l.useMemo)(()=>w.current?v:y,[w,y,v]);return Te(A,[g.current,$],{...f,internal_cacheKeySuffix:w.current+K(k.current)+K(x.current),abortable:R})}var G=require("@raycast/api");function Oe(e,n,t){let r=!!(e?.url&&e?.apiKey)&&t?.execute!==!1,a=e?.url?`${e.url}/api/v3${n}`:"",{data:u,error:i,isLoading:o,mutate:c}=se(a,{headers:{"X-Api-Key":e?.apiKey||"","Content-Type":"application/json"},execute:r,onError:m=>{console.error(`Radarr API Error (${e?.name||"Unknown"}):`,m),(0,G.showToast)({style:G.Toast.Style.Failure,title:"Radarr Error",message:`Failed to connect to ${e?.name||"Radarr"}: ${m.message}`}),t?.onError?.(m)},onData:t?.onData});return{data:u,error:i,isLoading:o,mutate:c}}function ie(e){return Oe(e,"/movie")}function oe(e){let n=e.images?.find(t=>t.coverType==="poster");return n?.remoteUrl||n?.url}var h=require("react/jsx-runtime");function le(){let[e,n]=(0,ce.useState)("all"),{currentInstance:t,isLoading:r,availableInstances:a,switchToInstance:u}=X(),{data:i,isLoading:o,error:c,mutate:m}=ie(t),b=f=>{let x=oe(f),k=f.hasFile,g=k?"\u{1F7E2}":"\u{1F534}",w=k?"Available":"Missing",E=`${f.year} \u2022 ${g} ${w}`;return(0,h.jsx)(s.Grid.Item,{content:{source:x||s.Icon.Video,fallback:s.Icon.Video},title:f.title,subtitle:E,actions:(0,h.jsxs)(s.ActionPanel,{children:[(0,h.jsxs)(s.ActionPanel.Section,{children:[(0,h.jsx)(s.Action.OpenInBrowser,{title:"Open in Radarr",url:`${t?.url}/movie/${f.tmdbId}`,icon:s.Icon.Globe}),f.movieFile&&(0,h.jsx)(s.Action.CopyToClipboard,{title:"Copy File Path",content:f.movieFile.path,icon:s.Icon.Clipboard}),f.imdbId&&(0,h.jsx)(s.Action.OpenInBrowser,{title:"Open in Imdb",url:`https://imdb.com/title/${f.imdbId}`,icon:s.Icon.Globe}),f.tmdbId&&(0,h.jsx)(s.Action.OpenInBrowser,{title:"Open in Tmdb",url:`https://themoviedb.org/movie/${f.tmdbId}`,icon:s.Icon.Globe})]}),(0,h.jsx)(s.ActionPanel.Section,{children:(0,h.jsx)(s.Action,{title:"Refresh",icon:s.Icon.RotateClockwise,onAction:m})}),a.length>1&&(0,h.jsxs)(s.ActionPanel.Section,{title:"Instance",children:[a.map(R=>(0,h.jsx)(s.Action,{title:`Switch to ${R.name}`,icon:t?.name===R.name?s.Icon.Check:s.Icon.Circle,onAction:()=>u(R)},R.name)),(0,h.jsx)(s.Action.Open,{title:"Open Preferences",target:"raycast://extensions/preferences",icon:s.Icon.Gear})]})]})},f.id)};if(r)return(0,h.jsx)(s.Grid,{isLoading:!0});if(a.length===0)return(0,h.jsx)(s.Grid,{children:(0,h.jsx)(s.Grid.EmptyView,{title:"No Radarr Instances Configured",description:"Please configure your Radarr instances in preferences",icon:s.Icon.ExclamationMark,actions:(0,h.jsx)(s.ActionPanel,{children:(0,h.jsx)(s.Action.Open,{title:"Open Preferences",target:"raycast://extensions/preferences",icon:s.Icon.Gear})})})});if(c)return(0,h.jsx)(s.Grid,{children:(0,h.jsx)(s.Grid.EmptyView,{title:"Failed to Load Movies",description:`Error: ${c.message}`,icon:s.Icon.ExclamationMark,actions:(0,h.jsx)(s.ActionPanel,{children:(0,h.jsx)(s.Action,{title:"Retry",icon:s.Icon.RotateClockwise,onAction:m})})})});let $=i?i.filter(f=>e==="all"?!0:e==="available"&&f.hasFile||e==="missing"&&!f.hasFile).sort((f,x)=>f.sortTitle.localeCompare(x.sortTitle)):[];return(0,h.jsx)(s.Grid,{isLoading:o,searchBarPlaceholder:`Search movie library on ${t?.name||"Radarr"}...`,columns:5,fit:s.Grid.Fit.Fill,aspectRatio:"3/4",searchBarAccessory:(0,h.jsxs)(s.Grid.Dropdown,{tooltip:"Filter by File Status",value:e,onChange:f=>n(f),children:[(0,h.jsx)(s.Grid.Dropdown.Item,{title:"All Movies",value:"all"}),(0,h.jsx)(s.Grid.Dropdown.Item,{title:"\u{1F7E2} Available",value:"available"}),(0,h.jsx)(s.Grid.Dropdown.Item,{title:"\u{1F534} Missing",value:"missing"})]}),children:$.length===0?(0,h.jsx)(s.Grid.EmptyView,{title:e==="all"?"No Movies Found":`No ${e.charAt(0).toUpperCase()+e.slice(1)} Movies`,description:e==="all"?"Your movie library is empty":`No ${e} movies found in your library`,icon:s.Icon.Video}):$.map(b)})}
