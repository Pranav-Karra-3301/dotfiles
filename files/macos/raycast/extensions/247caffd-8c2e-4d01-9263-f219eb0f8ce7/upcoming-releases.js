"use strict";var pe=Object.create;var V=Object.defineProperty;var me=Object.getOwnPropertyDescriptor;var ge=Object.getOwnPropertyNames;var be=Object.getPrototypeOf,ye=Object.prototype.hasOwnProperty;var $e=(e,n)=>{for(var r in n)V(e,r,{get:n[r],enumerable:!0})},q=(e,n,r,t)=>{if(n&&typeof n=="object"||typeof n=="function")for(let a of ge(n))!ye.call(e,a)&&a!==r&&V(e,a,{get:()=>n[a],enumerable:!(t=me(n,a))||t.enumerable});return e};var W=(e,n,r)=>(r=e!=null?pe(be(e)):{},q(n||!e||!e.__esModule?V(r,"default",{value:e,enumerable:!0}):r,e)),we=e=>q(V({},"__esModule",{value:!0}),e);var Fe={};$e(Fe,{default:()=>fe});module.exports=we(Fe);var ue=require("react"),i=require("@raycast/api");var P=require("react");var J=require("@raycast/api");function Z(){let e=(0,J.getPreferenceValues)(),n=[];if(!e.primaryInstanceName||!e.primaryInstanceUrl||!e.primaryInstanceApiKey)throw new Error("Primary Radarr instance configuration is incomplete");return n.push({name:e.primaryInstanceName,url:e.primaryInstanceUrl.replace(/\/$/,""),apiKey:e.primaryInstanceApiKey,isDefault:!0}),e.enableSecondaryInstance&&e.secondaryInstanceName&&e.secondaryInstanceUrl&&e.secondaryInstanceApiKey&&n.push({name:e.secondaryInstanceName,url:e.secondaryInstanceUrl.replace(/\/$/,""),apiKey:e.secondaryInstanceApiKey,isDefault:!1}),n}function X(){let e=(0,J.getPreferenceValues)(),n=Z();if(e.activeInstance==="secondary"&&e.enableSecondaryInstance&&n.length>1)return n[1];if(n.length>0)return n[0];throw new Error("No Radarr instances configured")}function Q(){let[e,n]=(0,P.useState)(null),[r,t]=(0,P.useState)(!0),a=(0,P.useCallback)(()=>{try{let o=X();n(o)}catch(o){console.error("Failed to load default instance:",o),n(null)}finally{t(!1)}},[]);(0,P.useEffect)(()=>{a()},[a]);let u=(0,P.useCallback)(o=>{n(o)},[]),s=(0,P.useMemo)(()=>{try{return Z()}catch{return[]}},[]);return{currentInstance:e,isLoading:r,availableInstances:s,switchToInstance:u}}var l=W(require("react")),p=require("@raycast/api");var Y=Object.prototype.hasOwnProperty;function j(e,n){var r,t;if(e===n)return!0;if(e&&n&&(r=e.constructor)===n.constructor){if(r===Date)return e.getTime()===n.getTime();if(r===RegExp)return e.toString()===n.toString();if(r===Array){if((t=e.length)===n.length)for(;t--&&j(e[t],n[t]););return t===-1}if(!r||typeof e=="object"){t=0;for(r in e)if(Y.call(e,r)&&++t&&!Y.call(n,r)||!(r in n)||!j(e[r],n[r]))return!1;return Object.keys(n).length===t}}return e!==e&&n!==n}var M=W(require("node:fs")),B=W(require("node:path")),ne=W(require("node:crypto"));var ae=require("react/jsx-runtime");function ke(e){let n=(0,l.useRef)(e),r=(0,l.useRef)(0);return j(e,n.current)||(n.current=e,r.current+=1),(0,l.useMemo)(()=>n.current,[r.current])}function R(e){let n=(0,l.useRef)(e);return n.current=e,n}function xe(e,n){let r=e instanceof Error?e.message:String(e);return(0,p.showToast)({style:p.Toast.Style.Failure,title:n?.title??"Something went wrong",message:n?.message??r,primaryAction:n?.primaryAction??ee(e),secondaryAction:n?.primaryAction?ee(e):void 0})}var ee=e=>{let n=!0,r="[Extension Name]...",t="";try{let s=JSON.parse((0,M.readFileSync)((0,B.join)(p.environment.assetsPath,"..","package.json"),"utf8"));r=`[${s.title}]...`,t=`https://raycast.com/${s.owner||s.author}/${s.name}`,(!s.owner||s.access==="public")&&(n=!1)}catch{}let a=p.environment.isDevelopment||n,u=e instanceof Error?e?.stack||e?.message||"":String(e);return{title:a?"Copy Logs":"Report Error",onAction(s){s.hide(),a?p.Clipboard.copy(u):(0,p.open)(`https://github.com/raycast/extensions/issues/new?&labels=extension%2Cbug&template=extension_bug_report.yml&title=${encodeURIComponent(r)}&extension-url=${encodeURI(t)}&description=${encodeURIComponent(`#### Error:
\`\`\`
${u}
\`\`\`
`)}`)}}};function ve(e,n,r){let t=(0,l.useRef)(0),[a,u]=(0,l.useState)({isLoading:!0}),s=R(e),o=R(r?.abortable),c=R(n||[]),b=R(r?.onError),g=R(r?.onData),w=R(r?.onWillExecute),S=R(r?.failureToastOptions),v=R(a.data),f=(0,l.useRef)(null),d=(0,l.useRef)({page:0}),y=(0,l.useRef)(!1),x=(0,l.useRef)(!0),I=(0,l.useRef)(50),k=(0,l.useCallback)(()=>(o.current&&(o.current.current?.abort(),o.current.current=new AbortController),++t.current),[o]),$=(0,l.useCallback)((...U)=>{let E=k();w.current?.(U),u(h=>({...h,isLoading:!0}));let O=Se(s.current)(...U);function D(h){return h.name=="AbortError"||E===t.current&&(b.current?b.current(h):p.environment.launchType!==p.LaunchType.Background&&xe(h,{title:"Failed to fetch latest data",primaryAction:{title:"Retry",onAction(_){_.hide(),f.current?.(...c.current||[])}},...S.current}),u({error:h,isLoading:!1})),h}return typeof O=="function"?(y.current=!0,O(d.current).then(({data:h,hasMore:_,cursor:de})=>(E===t.current&&(d.current&&(d.current.cursor=de,d.current.lastItem=h?.[h.length-1]),g.current&&g.current(h,d.current),_&&(I.current=h.length),x.current=_,u(he=>d.current.page===0?{data:h,isLoading:!1}:{data:(he.data||[])?.concat(h),isLoading:!1})),h),h=>(x.current=!1,D(h)))):(y.current=!1,O.then(h=>(E===t.current&&(g.current&&g.current(h),u({data:h,isLoading:!1})),h),D))},[g,b,c,s,u,f,w,d,S,k]);f.current=$;let A=(0,l.useCallback)(()=>{d.current={page:0};let U=c.current||[];return $(...U)},[$,c]),T=(0,l.useCallback)(async(U,E)=>{let O;try{if(E?.optimisticUpdate){k(),typeof E?.rollbackOnError!="function"&&E?.rollbackOnError!==!1&&(O=structuredClone(v.current?.value));let D=E.optimisticUpdate;u(h=>({...h,data:D(h.data)}))}return await U}catch(D){if(typeof E?.rollbackOnError=="function"){let h=E.rollbackOnError;u(_=>({..._,data:h(_.data)}))}else E?.optimisticUpdate&&E?.rollbackOnError!==!1&&u(h=>({...h,data:O}));throw D}finally{E?.shouldRevalidateAfter!==!1&&(p.environment.launchType===p.LaunchType.Background||p.environment.commandMode==="menu-bar"?await A():A())}},[A,v,u,k]),C=(0,l.useCallback)(()=>{d.current.page+=1;let U=c.current||[];$(...U)},[d,c,$]);(0,l.useEffect)(()=>{d.current={page:0},r?.execute!==!1?$(...n||[]):k()},[ke([n,r?.execute,$]),o,d]),(0,l.useEffect)(()=>()=>{k()},[k]);let F=r?.execute!==!1?a.isLoading:!1,N={...a,isLoading:F},z=y.current?{pageSize:I.current,hasMore:x.current,onLoadMore:C}:void 0;return{...N,revalidate:A,mutate:T,pagination:z}}function Se(e){return e===Promise.all||e===Promise.race||e===Promise.resolve||e===Promise.reject?e.bind(Promise):e}function te(e){return typeof e!="function"?!1:/^function\s+\w*\s*\(\s*\)\s*{\s+\[native code\]\s+}$/i.exec(Function.prototype.toString.call(e))!==null}function Re(e){return e instanceof URLSearchParams?e.toString():e}function se(e,n=[]){function r(t){return"update"in e?e.update(t,"utf8"):e.write(t)}return{dispatch:function(t){t=Re(t),t===null?this._null():this["_"+typeof t](t)},_object:function(t){let a=/\[object (.*)\]/i,u=Object.prototype.toString.call(t),s=a.exec(u)?.[1]??"unknown:["+u+"]";s=s.toLowerCase();let o=null;if((o=n.indexOf(t))>=0){this.dispatch("[CIRCULAR:"+o+"]");return}else n.push(t);if(Buffer.isBuffer(t))return r("buffer:"),r(t.toString("utf8"));if(s!=="object"&&s!=="function"&&s!=="asyncfunction")if(this["_"+s])this["_"+s](t);else throw new Error('Unknown object type "'+s+'"');else{let c=Object.keys(t);c=c.sort(),te(t)||c.splice(0,0,"prototype","__proto__","constructor"),r("object:"+c.length+":");let b=this;return c.forEach(function(g){b.dispatch(g),r(":"),b.dispatch(t[g]),r(",")})}},_array:function(t,a){a=typeof a<"u"?a:!1;let u=this;if(r("array:"+t.length+":"),!a||t.length<=1){t.forEach(function(c){u.dispatch(c)});return}let s=[],o=t.map(function(c){let b=Ee(),g=n.slice();return se(b,g).dispatch(c),s=s.concat(g.slice(n.length)),b.read().toString()});n=n.concat(s),o.sort(),this._array(o,!1)},_date:function(t){r("date:"+t.toJSON())},_symbol:function(t){r("symbol:"+t.toString())},_error:function(t){r("error:"+t.toString())},_boolean:function(t){r("bool:"+t.toString())},_string:function(t){r("string:"+t.length+":"),r(t.toString())},_function:function(t){r("fn:"),te(t)?this.dispatch("[native]"):this.dispatch(t.toString()),this.dispatch("function-name:"+String(t.name)),this._object(t)},_number:function(t){r("number:"+t.toString())},_xml:function(t){r("xml:"+t.toString())},_null:function(){r("Null")},_undefined:function(){r("Undefined")},_regexp:function(t){r("regex:"+t.toString())},_uint8array:function(t){r("uint8array:"),this.dispatch(Array.prototype.slice.call(t))},_uint8clampedarray:function(t){r("uint8clampedarray:"),this.dispatch(Array.prototype.slice.call(t))},_int8array:function(t){r("int8array:"),this.dispatch(Array.prototype.slice.call(t))},_uint16array:function(t){r("uint16array:"),this.dispatch(Array.prototype.slice.call(t))},_int16array:function(t){r("int16array:"),this.dispatch(Array.prototype.slice.call(t))},_uint32array:function(t){r("uint32array:"),this.dispatch(Array.prototype.slice.call(t))},_int32array:function(t){r("int32array:"),this.dispatch(Array.prototype.slice.call(t))},_float32array:function(t){r("float32array:"),this.dispatch(Array.prototype.slice.call(t))},_float64array:function(t){r("float64array:"),this.dispatch(Array.prototype.slice.call(t))},_arraybuffer:function(t){r("arraybuffer:"),this.dispatch(new Uint8Array(t))},_url:function(t){r("url:"+t.toString())},_map:function(t){r("map:");let a=Array.from(t);this._array(a,!0)},_set:function(t){r("set:");let a=Array.from(t);this._array(a,!0)},_file:function(t){r("file:"),this.dispatch([t.name,t.size,t.type,t.lastModified])},_blob:function(){throw Error(`Hashing Blob objects is currently not supported
(see https://github.com/puleos/object-hash/issues/26)
Use "options.replacer" or "options.ignoreUnknown"
`)},_domwindow:function(){r("domwindow")},_bigint:function(t){r("bigint:"+t.toString())},_process:function(){r("process")},_timer:function(){r("timer")},_pipe:function(){r("pipe")},_tcp:function(){r("tcp")},_udp:function(){r("udp")},_tty:function(){r("tty")},_statwatcher:function(){r("statwatcher")},_securecontext:function(){r("securecontext")},_connection:function(){r("connection")},_zlib:function(){r("zlib")},_context:function(){r("context")},_nodescript:function(){r("nodescript")},_httpparser:function(){r("httpparser")},_dataview:function(){r("dataview")},_signal:function(){r("signal")},_fsevent:function(){r("fsevent")},_tlswrap:function(){r("tlswrap")}}}function Ee(){return{buf:"",write:function(e){this.buf+=e},end:function(e){this.buf+=e},read:function(){return this.buf}}}function Ie(e,n){let r=this[e];return r instanceof Date?`__raycast_cached_date__${r.toISOString()}`:Buffer.isBuffer(r)?`__raycast_cached_buffer__${r.toString("base64")}`:n}function Ae(e,n){return typeof n=="string"&&n.startsWith("__raycast_cached_date__")?new Date(n.replace("__raycast_cached_date__","")):typeof n=="string"&&n.startsWith("__raycast_cached_buffer__")?Buffer.from(n.replace("__raycast_cached_buffer__",""),"base64"):n}function K(e){let n=ne.default.createHash("sha1");return se(n).dispatch(e),n.digest("hex")}var Te=Symbol("cache without namespace"),re=new Map;function Pe(e,n,r){let t=r?.cacheNamespace||Te,a=re.get(t)||re.set(t,new p.Cache({namespace:r?.cacheNamespace})).get(t);if(!a)throw new Error("Missing cache");let u=R(e),s=R(n),o=(0,l.useSyncExternalStore)(a.subscribe,()=>{try{return a.get(u.current)}catch(w){console.error("Could not get Cache data:",w);return}}),c=(0,l.useMemo)(()=>{if(typeof o<"u"){if(o==="undefined")return;try{return JSON.parse(o,Ae)}catch(w){return console.warn("The cached data is corrupted",w),s.current}}else return s.current},[o,s]),b=R(c),g=(0,l.useCallback)(w=>{let S=typeof w=="function"?w(b.current):w;if(typeof S>"u")a.set(u.current,"undefined");else{let v=JSON.stringify(S,Ie);a.set(u.current,v)}return S},[a,u,b]);return[c,g]}var L=Symbol();function Ce(e,n,r){let{initialData:t,keepPreviousData:a,internal_cacheKeySuffix:u,...s}=r||{},o=(0,l.useRef)(null),[c,b]=Pe(K(n||[])+u,L,{cacheNamespace:K(e)}),g=(0,l.useRef)(c!==L?c:t),w=(0,l.useRef)(void 0),{mutate:S,revalidate:v,...f}=ve(e,n||[],{...s,onData(k,$){w.current=$,s.onData&&s.onData(k,$),!($&&$.page>0)&&(o.current="promise",g.current=k,b(k))}}),d,y=f.pagination;w.current&&w.current.page>0&&f.data?d=f.data:o.current==="promise"?d=g.current:a&&c!==L?(d=c,y&&(y.hasMore=!0,y.pageSize=c.length)):a&&c===L?d=g.current:c!==L?(d=c,y&&(y.hasMore=!0,y.pageSize=c.length)):d=t;let x=R(d),I=(0,l.useCallback)(async(k,$)=>{let A;try{if($?.optimisticUpdate){typeof $?.rollbackOnError!="function"&&$?.rollbackOnError!==!1&&(A=structuredClone(x.current));let T=$.optimisticUpdate(x.current);o.current="cache",g.current=T,b(T)}return await S(k,{shouldRevalidateAfter:$?.shouldRevalidateAfter})}catch(T){if(typeof $?.rollbackOnError=="function"){let C=$.rollbackOnError(x.current);o.current="cache",g.current=C,b(C)}else $?.optimisticUpdate&&$?.rollbackOnError!==!1&&(o.current="cache",g.current=A,b(A));throw T}},[b,S,x,g,o]);return(0,l.useEffect)(()=>{c!==L&&(o.current="cache",g.current=c)},[c]),{data:d,isLoading:f.isLoading,error:f.error,mutate:w.current&&w.current.page>0?S:I,pagination:y,revalidate:v}}function Ue(e){if(e){let n=Me(e);if(!n)return!1;if(n.subtype==="json"||n.suffix==="json"||n.suffix&&/\bjson\b/i.test(n.suffix)||n.subtype&&/\bjson\b/i.test(n.subtype))return!0}return!1}var _e=/^([A-Za-z0-9][A-Za-z0-9!#$&^_-]{0,126})\/([A-Za-z0-9][A-Za-z0-9!#$&^_.+-]{0,126});?$/;function Me(e){let n=e.indexOf(";"),r=n!==-1?e.slice(0,n).trim():e.trim(),t=_e.exec(r.toLowerCase().toLowerCase());if(!t)return;let a=t[1],u=t[2],s,o=u.lastIndexOf("+");return o!==-1&&(s=u.substring(o+1),u=u.substring(0,o)),{type:a,subtype:u,suffix:s}}async function Oe(e){if(!e.ok)throw new Error(e.statusText);let n=e.headers.get("content-type");return n&&Ue(n)?await e.json():await e.text()}function De(e){return{data:e,hasMore:!1}}function ie(e,n){let{parseResponse:r,mapResult:t,initialData:a,execute:u,keepPreviousData:s,onError:o,onData:c,onWillExecute:b,failureToastOptions:g,...w}=n||{},S={initialData:a,execute:u,keepPreviousData:s,onError:o,onData:c,onWillExecute:b,failureToastOptions:g},v=R(r||Oe),f=R(t||De),d=(0,l.useRef)(null),y=(0,l.useRef)(null),x=typeof e=="function"?e({page:0}):void 0;(!d.current||typeof y.current>"u"||y.current!==x)&&(d.current=e),y.current=x;let I=(0,l.useRef)(null),k=(0,l.useCallback)((T,C)=>async F=>{let N=await fetch(T(F),{signal:I.current?.signal,...C}),z=await v.current(N);return f.current?.(z)},[v,f]),$=(0,l.useCallback)(async(T,C)=>{let F=await fetch(T,{signal:I.current?.signal,...C}),N=await v.current(F);return f.current(N)?.data},[v,f]),A=(0,l.useMemo)(()=>y.current?k:$,[y,$,k]);return Ce(A,[d.current,w],{...S,internal_cacheKeySuffix:y.current+K(f.current)+K(v.current),abortable:I})}var G=require("@raycast/api");function Le(e,n,r){let t=!!(e?.url&&e?.apiKey)&&r?.execute!==!1,a=e?.url?`${e.url}/api/v3${n}`:"",{data:u,error:s,isLoading:o,mutate:c}=ie(a,{headers:{"X-Api-Key":e?.apiKey||"","Content-Type":"application/json"},execute:t,onError:b=>{console.error(`Radarr API Error (${e?.name||"Unknown"}):`,b),(0,G.showToast)({style:G.Toast.Style.Failure,title:"Radarr Error",message:`Failed to connect to ${e?.name||"Radarr"}: ${b.message}`}),r?.onError?.(b)},onData:r?.onData});return{data:u,error:s,isLoading:o,mutate:c}}function oe(e,n,r){let t=new URLSearchParams;n&&t.set("start",n),r&&t.set("end",r),t.set("unmonitored","true");let a=`/calendar${t.toString()?`?${t.toString()}`:""}`;return Le(e,a)}function ce(e){if(!e)return"Not available";try{return new Date(e).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"})}catch{return e}}function H(e){let n=new Date;return e.digitalRelease&&new Date(e.digitalRelease)>n?e.digitalRelease:e.inCinemas&&new Date(e.inCinemas)>n?e.inCinemas:e.physicalRelease&&new Date(e.physicalRelease)>n?e.physicalRelease:e.digitalRelease||e.inCinemas||e.physicalRelease||null}function le(e){let n=e.images?.find(r=>r.coverType==="poster");return n?.remoteUrl||n?.url}var m=require("react/jsx-runtime");function fe(){let[e,n]=(0,ue.useState)("all"),{currentInstance:r,isLoading:t,availableInstances:a,switchToInstance:u}=Q(),s=new Date,o=new Date(s.getTime()+1440*60*60*1e3),{data:c,isLoading:b,error:g,mutate:w}=oe(r,s.toISOString().split("T")[0],o.toISOString().split("T")[0]),S=f=>{let d=le(f),y=H(f),x=y?ce(y):"TBA",I=`${f.year} \u2022 ${x}`;return(0,m.jsx)(i.Grid.Item,{content:{source:d||i.Icon.Video,fallback:i.Icon.Video},title:f.title,subtitle:I,actions:(0,m.jsxs)(i.ActionPanel,{children:[(0,m.jsxs)(i.ActionPanel.Section,{children:[(0,m.jsx)(i.Action.OpenInBrowser,{title:"Open in Radarr",url:`${r?.url}/movie/${f.tmdbId}`,icon:i.Icon.Globe}),f.imdbId&&(0,m.jsx)(i.Action.OpenInBrowser,{title:"Open in Imdb",url:`https://imdb.com/title/${f.imdbId}`,icon:i.Icon.Globe}),f.tmdbId&&(0,m.jsx)(i.Action.OpenInBrowser,{title:"Open in Tmdb",url:`https://themoviedb.org/movie/${f.tmdbId}`,icon:i.Icon.Globe})]}),(0,m.jsx)(i.ActionPanel.Section,{children:(0,m.jsx)(i.Action,{title:"Refresh",icon:i.Icon.RotateClockwise,onAction:()=>w()})}),a.length>1&&(0,m.jsxs)(i.ActionPanel.Section,{title:"Instance",children:[a.map(k=>(0,m.jsx)(i.Action,{title:`Switch to ${k.name}`,icon:r?.name===k.name?i.Icon.Check:i.Icon.Circle,onAction:()=>u(k)},k.name)),(0,m.jsx)(i.Action.Open,{title:"Open Preferences",target:"raycast://extensions/preferences",icon:i.Icon.Gear})]})]})},f.id)};if(t)return(0,m.jsx)(i.Grid,{isLoading:!0});if(a.length===0)return(0,m.jsx)(i.Grid,{children:(0,m.jsx)(i.Grid.EmptyView,{title:"No Radarr Instances Configured",description:"Please configure your Radarr instances in preferences",icon:i.Icon.ExclamationMark,actions:(0,m.jsx)(i.ActionPanel,{children:(0,m.jsx)(i.Action.Open,{title:"Open Preferences",target:"raycast://extensions/preferences",icon:i.Icon.Gear})})})});if(g)return(0,m.jsx)(i.Grid,{children:(0,m.jsx)(i.Grid.EmptyView,{title:"Failed to Load Calendar",description:`Error: ${g.message}`,icon:i.Icon.ExclamationMark,actions:(0,m.jsx)(i.ActionPanel,{children:(0,m.jsx)(i.Action,{title:"Retry",icon:i.Icon.RotateClockwise,onAction:()=>w()})})})});let v=c?c.filter(f=>f.hasFile?!1:e==="all"?!0:e==="monitored"&&f.monitored||e==="unmonitored"&&!f.monitored).sort((f,d)=>{let y=H(f),x=H(d);return!y&&!x?f.sortTitle.localeCompare(d.sortTitle):y?x?new Date(y).getTime()-new Date(x).getTime():-1:1}):[];return(0,m.jsx)(i.Grid,{isLoading:b,searchBarPlaceholder:`Search upcoming releases on ${r?.name||"Radarr"}...`,columns:5,fit:i.Grid.Fit.Fill,aspectRatio:"3/4",searchBarAccessory:(0,m.jsxs)(i.Grid.Dropdown,{tooltip:"Filter by Monitoring Status",value:e,onChange:f=>n(f),children:[(0,m.jsx)(i.Grid.Dropdown.Item,{title:"All Movies",value:"all"}),(0,m.jsx)(i.Grid.Dropdown.Item,{title:"\u{1F4E1} Monitored",value:"monitored"}),(0,m.jsx)(i.Grid.Dropdown.Item,{title:"\u26AB Unmonitored",value:"unmonitored"})]}),children:v.length===0?(0,m.jsx)(i.Grid.EmptyView,{title:e==="all"?"No Upcoming Releases":`No ${e.charAt(0).toUpperCase()+e.slice(1)} Releases`,description:e==="all"?"No movies found in the next 2 months":`No ${e} movies found in the next 2 months`,icon:i.Icon.Calendar}):v.map(S)})}
